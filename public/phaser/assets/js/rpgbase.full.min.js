var $;function Condition(t){if(void 0===t)throw console.trace(),"Condition constructor requires a parameter object";if(!t.hasOwnProperty("type"))throw console.trace(),"Condition must have a defined type";switch(this._type=t.type,this._pass=t.pass,void 0!==this._pass&&this._pass.hasOwnProperty("type")&&(this._pass.hasOwnProperty("pass")||this._pass.hasOwnProperty("fail")||this._pass.hasOwnProperty("conditionals"))&&(this._pass=new Condition(this._pass)),this._fail=t.fail,void 0!==this._fail&&this._fail.hasOwnProperty("type")&&this._fail.hasOwnProperty("pass")&&this._fail.hasOwnProperty("fail")&&(this._fail=new Condition(this._fail)),t.type){case"multipleAnd":case"multipleOr":case"multipleSwitch":case"randomUntilPass":this._conditionals=[];for(var e=t.conditionals.length-1;e>=0;e--)this._conditionals.push(new Condition(t.conditionals[e]));break;case"propertyComparisonEquals":case"propertyComparisonLessThanEquals":this._property=t.property,t.hasOwnProperty("comparisonField")?this._comparisonField=t.comparisonField:t.hasOwnProperty("comparisonFunction")&&(this._comparisonFunction=t.comparisonFunction,this._comparisonArgs=t.comparisonArgs),this._comparison=t.comparison}}function DirectionEntity(t,e,r,a){this._val=t,this._title=e,this._dx=r,this._dy=a}"undefined"!=typeof module&&($=require("jquery")),Condition.prototype.test=function(t){var e=this._pass;switch(this._type){case"returnPass":break;case"multipleAnd":for(var r=!0,a=this._conditionals.length-1;a>=0;a--)if(!this._conditionals[a].test(t)){r=!1;break}r||(e=this._fail);break;case"multipleOr":for(r=!1,a=this._conditionals.length-1;a>=0;a--)if(this._conditionals[a].test(t)){r=!0;break}r||(e=this._fail);break;case"multipleSwitch":for(a=this._conditionals.length-1;a>=0;a--)if(this._conditionals[a].test(t)){e=this._conditionals[a]._pass;break}break;case"randomUntilPass":for(e=!1,tries=0;!e;)if(tries++,e=this.Dice.getRandomMember(this._conditionals).test(t),tries>100)throw console.trace(this._conditionals,t),{message:"FAILED CONDITIONAL MORE THAN 100 ATTEMPTS",testArgs:t,conditionals:this._conditionals};break;case"propertyComparisonEquals":var i=t[this._property];this.hasOwnProperty("_comparisonField")&&(i=i[this._comparisonField]),this.hasOwnProperty("_comparisonFunction")&&(i=i[this._comparisonFunction](this._comparisonArgs)),i!==this._comparison&&(e=this._fail),e instanceof Condition&&(e=e.test(t));break;case"propertyComparisonLessThanEquals":i=t[this._property];this.hasOwnProperty("_comparisonField")&&(i=i[this._comparisonField]),this.hasOwnProperty("_comparisonFunction")&&(i=i[this._comparisonFunction](this._comparisonArgs)),i>this._comparison&&(e=this._fail),e instanceof Condition&&(e=e.test(t))}return e},Object.defineProperty(DirectionEntity.prototype,"delta",{get(){return{x:this._dx,y:this._dy}}}),DirectionEntity.prototype.equals=function(t){var e=!1;return t instanceof DirectionEntity&&(e=this._val===t._val&&this._title===t._title),e},Object.defineProperty(DirectionEntity.prototype,"value",{get(){return this._val}}),Object.defineProperty(DirectionEntity.prototype,"title",{get(){return this._title}});var Direction={NORTH:new DirectionEntity(1,"NORTH",0,1),SOUTH:new DirectionEntity(4,"SOUTH",0,-1),EAST:new DirectionEntity(2,"EAST",1,0),WEST:new DirectionEntity(8,"WEST",-1,0)};function EquipmentItemModifier(t){if(this._percent=!1,this._special=0,this._value=0,void 0!==t){if(null===t)throw"EquipmentItemModifier() - copy parameter is null";if(!(t instanceof EquipmentItemModifier))throw"EquipmentItemModifier() - copy parameter must be an EquipmentItemModifier";this.set(t)}}function FlagSet(){this._flags=0}function InteractiveObject(t){if(isNaN(parseInt(t)))throw"InteractiveObject() requires a valid reference id";if(void 0===this.BaseConstants)throw"InteractiveObject() an instance of BaseConstants must be set on the InteractiveObject.prototype before instantiation";if(void 0===this.FlagSetClass)throw"InteractiveObject() a FlagSetClass must be set on the InteractiveObject.prototype before instantiation";if(void 0===this.InventoryClass)throw"InteractiveObject() a InventoryClass must be set on the InteractiveObject.prototype before instantiation";if(void 0===this.ItemDataClass)throw"InteractiveObject() an ItemDataClass must be set on the InteractiveObject.prototype before instantiation";if(void 0===this.NpcDataClass)throw"InteractiveObject() a NpcDataClass must be set on the InteractiveObject.prototype before instantiation";if(void 0===this.PcDataClass)throw"InteractiveObject() a PcDataClass must be set on the InteractiveObject.prototype before instantiation";if(void 0===this.ScriptClass)throw"InteractiveObject() a ScriptClass must be set on the InteractiveObject.prototype before instantiation";this._data,this._groups={},this._inventory,this._ioFlags=new this.FlagSetClass,this._localizedName,this._mainevent,this._refId=t,this._script=null,this._overScript=null,this._spellsOn=[]}function InventoryData(){if(void 0===this.BaseConstants)throw"IoNpcData() an instance of BaseConstants must be set on the IoNpcData.prototype before instantiation";if(void 0===this.InteractiveInstance)throw"InventoryData() an InteractiveInstance must be set on the InventoryData.prototype before instantiation";if(void 0===this.IoClass)throw"InventoryData() an IoClass must be set on the InventoryData.prototype before instantiation";if(void 0===this.ScriptInstance)throw"InventoryData() a ScriptInstance must be set on the InventoryData.prototype before instantiation";if(this._io,this._slots=[],this.constructor===InventoryData)throw"You cannot create an instance of InventoryData Class - you must extend the prototype";this.init()}function InventorySlot(){if(void 0===this.InteractiveInstance)throw"InventorySlot() a InteractiveInstance must be set on the IoPcData.prototype before instantiation";this._io,this._show=!0}function IoBehaviourData(){if(void 0===this.BaseConstants)throw"IoBehaviourData() an instance of BaseConstants must be set on the IoBehaviourData.prototype before instantiation";if(void 0===this.FlagSetClass)throw"IoBehaviourData() a FlagSetClass must be set on the IoBehaviourData.prototype before instantiation";this._behaviourParam=0,this._behaviour=new this.FlagSetClass,this._exists=!1,this._moveMode=this.BaseConstants.WALKMODE,this._tactics=0,this._target=-1}function IoEquipItem(){if(void 0===this.EquipModifierClass)throw"IoBehaviourData() an EquipModifierClass must be set on the IoBehaviourData.prototype before instantiation";this._elements=[]}function IoItemData(){if(this.constructor===IoItemData)throw"You cannot create an instance of IoItemData Class - you must extend the prototype.  Check ../tests/samples for an example";if(void 0===this.EquipModifierClass)throw"IoItemData() an EquipModifierClass must be set on the IoItemData.prototype before instantiation";if(void 0===this.FlagSetClass)throw"IoItemData() a FlagSetClass must be set on the IoItemData.prototype before instantiation";if(void 0===this.InteractiveInstance)throw"IoNpcData() a InteractiveInstance must be set on the IoPcData.prototype before instantiation";this._count=1,this._elements=[],this._io=null,this._food_value=0,this._lightValue=-1,this._maxcount=1,this._price=1,this._stacksize=1,this._stealvalue=-1,this._typeFlags=new this.FlagSetClass,this.init()}function IoNpcData(){if(void 0===this.BaseConstants)throw"IoNpcData() an instance of BaseConstants must be set on the IoNpcData.prototype before instantiation";if(void 0===this.BehaviourClass)throw"IoNpcData() a BehaviourClass must be set on the IoNpcData.prototype before instantiation";if(void 0===this.InteractiveInstance)throw"IoNpcData() a InteractiveInstance must be set on the IoPcData.prototype before instantiation";if(void 0===this.ScriptInstance)throw"IoNpcData() a ScriptInstance must be set on the IoNpcData.prototype before instantiation";if(this._behaviour=new this.BehaviourClass,this._io=null,this._moveMode=this.BaseConstants.WALKMODE,this._behaviours=[new this.BehaviourClass,new this.BehaviourClass,new this.BehaviourClass,new this.BehaviourClass,new this.BehaviourClass],this.constructor===IoNpcData)throw"You cannot create an instance of IoNpcData Class - you must extend the prototype"}function IoPcData(){if(this.constructor===IoPcData)throw"You cannot create an instance of IoPcData Class - you must extend the prototype";if(void 0===this.AttributeClass)throw"IoPcData() an AttributeClass must be set on the IoPcData.prototype before instantiation";if(void 0===this.BaseConstants)throw"IoPcData() an instance of BaseConstants must be set on the IoPcData.prototype before instantiation";if(void 0===this.InteractiveInstance)throw"IoNpcData() a InteractiveInstance must be set on the IoPcData.prototype before instantiation";if(void 0===this.ScriptInstance)throw"IoPcData() a ScriptInstance must be set on the IoPcData.prototype before instantiation";this._attributes={},this._equipped=[],this._gender=0,this._gold=0,this._io=null,this._level=0,this._xp=0,this._init()}function IoScript(){if(void 0===this.ActionClass)throw"IoScript() an ActionClass must be set on the IoScript.prototype before instantiation";if(void 0===this.BaseConstants)throw"IoBehaviourData() an instance of BaseConstants must be set on the IoBehaviourData.prototype before instantiation";if(void 0===this.FlagSetClass)throw"IoScript() a FlagSetClass must be set on the IoScript.prototype before instantiation";if(void 0===this.InteractiveInstance)throw"IoNpcData() a InteractiveInstance must be set on the IoPcData.prototype before instantiation";var t=this;this._actions={DEATH:new this.ActionClass(function(e){return t.BaseConstants.ACCEPT}),INIT:new this.ActionClass(function(e){return t.BaseConstants.ACCEPT})},this._allowedEvents=new this.FlagSetClass,this._io=null,this._master=null,this._timers=[],this._variables={}}function IoSpellData(){if(void 0===this.FlagSetClass)throw"IoSpellData() a FlagSetClass must be set on the IoSpellData.prototype before instantiation";this._spellId=-1,this._duration=0,this._flags=new this.FlagSetClass,this._level=0,this._target=-1}function Location(t){this._x,this._y,this.set(t)}Object.defineProperty(EquipmentItemModifier.prototype,"percent",{get(){return this._percent},set(t){if("boolean"!=typeof t)throw"EquipmentItemModifier.percent requires a boolean";this._percent=t}}),Object.defineProperty(EquipmentItemModifier.prototype,"special",{get(){return this._special},set(t){if(isNaN(parseInt(t)))throw"EquipmentItemModifier.special requires a valid number";this._special=t}}),Object.defineProperty(EquipmentItemModifier.prototype,"value",{get(){return this._value},set(t){if(isNaN(parseInt(t)))throw"EquipmentItemModifier.value requires a valid number";this._value=t}}),EquipmentItemModifier.prototype.set=function(t){if(void 0===t)throw"EquipmentItemModifier.set() requires an EquipmentItemModifier to clone";if(null===t)throw"EquipmentItemModifier.set() requires an EquipmentItemModifier to clone";if(!(t instanceof EquipmentItemModifier))throw"EquipmentItemModifier.set() - clone parameter must be an EquipmentItemModifier";this.percent=t.percent,this.special=t.special,this.value=t.value},FlagSet.prototype.add=function(t){if(isNaN(parseInt(t)))throw"FlagSet.addFlag() requires a valid number";if(Math.log(t)/Math.log(2)%1!=0)throw"FlagSet.addFlag() requires a power of 2";this._flags|=t},FlagSet.prototype.addFlag=function(t){if(isNaN(parseInt(t)))throw"FlagSet.addFlag() requires a valid number";if(Math.log(t)/Math.log(2)%1!=0)throw"FlagSet.addFlag() requires a power of 2";this._flags|=t},FlagSet.prototype.clear=function(){this._flags=0},FlagSet.prototype.clearFlags=function(){this._flags=0},FlagSet.prototype.has=function(t){if(isNaN(parseInt(t)))throw"FlagSet.hasFlag() requires a valid number";if(Math.log(t)/Math.log(2)%1!=0)throw"FlagSet.hasFlag() requires a power of 2";return(this._flags&t)==t},FlagSet.prototype.hasFlag=function(t){if(isNaN(parseInt(t)))throw"FlagSet.hasFlag() requires a valid number";if(Math.log(t)/Math.log(2)%1!=0)throw"FlagSet.hasFlag() requires a power of 2";return(this._flags&t)==t},FlagSet.prototype.remove=function(t){if(isNaN(parseInt(t)))throw"FlagSet.removeFlag() requires a valid number";if(Math.log(t)/Math.log(2)%1!=0)throw"FlagSet.removeFlag() requires a power of 2";this._flags&=~t},FlagSet.prototype.removeFlag=function(t){if(isNaN(parseInt(t)))throw"FlagSet.removeFlag() requires a valid number";if(Math.log(t)/Math.log(2)%1!=0)throw"FlagSet.removeFlag() requires a power of 2";this._flags&=~t},Object.defineProperty(InteractiveObject.prototype,"data",{get(){return this._data},set(t){if(null==t)throw"InteractiveObject.data - no data was provided";if(t instanceof this.ItemDataClass&&!this._ioFlags.has(this.BaseConstants.IO_ITEM))throw"InteractiveObject.data - cannot set Item data without setting ITEM flag first";if(t instanceof this.NpcDataClass&&!this._ioFlags.has(this.BaseConstants.IO_NPC))throw"InteractiveObject.data - cannot set NPC data without setting NPC flag first";if(t instanceof this.PcDataClass&&!this._ioFlags.has(this.BaseConstants.IO_PC))throw"InteractiveObject.data - cannot set PC data without setting PC flag first";if(!(t instanceof this.ItemDataClass||t instanceof this.NpcDataClass||t instanceof this.PcDataClass))throw"InteractiveObject.data must be either an instance of IoItemData, IoNpcData, or IoPcData";this._data=t,void 0!==this._data.io&&null!==this._data.io||(this._data.io=this)}}),Object.defineProperty(InteractiveObject.prototype,"inventory",{get(){return this._inventory},set(t){if(!(t instanceof this.InventoryClass))throw"InteractiveObject.inventory must be an instance of InventoryData";this._inventory=t,void 0!==this._inventory.io&&null!==this._inventory.io||(this._inventory.io=this)}}),Object.defineProperty(InteractiveObject.prototype,"ioFlags",{get(){return this._ioFlags}}),Object.defineProperty(InteractiveObject.prototype,"localizedName",{get(){return this._localizedName},set(t){if("string"!=typeof t||0===t.length)throw console.trace(t),"InteractiveObject.localizedName must be a string of 1 or more characters";this._localizedName=t}}),Object.defineProperty(InteractiveObject.prototype,"mainevent",{get(){return this._mainevent},set(t){"main"===t.toLowerCase()?this._mainevent=null:this._mainevent=t}}),Object.defineProperty(InteractiveObject.prototype,"refId",{get(){return this._refId}}),Object.defineProperty(InteractiveObject.prototype,"script",{get(){return this._script},set(t){if(void 0===t)throw"No script was provided";if(null===t)throw"script parameter is null";if(!(t instanceof this.ScriptClass))throw"script parameter must be an instance of IoScript";this._script=t,null===this._script.io&&(this._script.io=this)}}),Object.defineProperty(InteractiveObject.prototype,"overscript",{get(){return this._overScript},set(t){if(null==t||!(t instanceof this.ScriptClass))throw"overscript parameter must be an instance of IoScript";this._overScript=t,null===this._overScript.io&&(this._overScript.io=this)}}),InteractiveObject.prototype.addToGroup=function(t){if("string"!=typeof t||0===t.length)throw"InteractiveObject.removeFromGroup() must be a string of 1 or more characters";this._groups[t.toLowerCase()]=0},InteractiveObject.prototype.equals=function(t){var e=!1;return t instanceof InteractiveObject&&((e=this.refId===t.refId)&&(e=this._ioFlags===t._ioFlags),e&&(e=this.data===t.data)),e},InteractiveObject.prototype.hasOverscript=function(){return this._overScript instanceof this.ScriptClass},InteractiveObject.prototype.isInGroup=function(t){if("string"!=typeof t||0===t.length)throw"InteractiveObject.isInGroup() must be a string of 1 or more characters";return this._groups.hasOwnProperty(t.toLowerCase())},InteractiveObject.prototype.removeFromAllGroups=function(){for(var t in this._groups)delete this._groups[t]},InteractiveObject.prototype.removeAllSpellsOn=function(){this._spellsOn.length=0},InteractiveObject.prototype.removeFromGroup=function(t){if("string"!=typeof t||0===t.length)throw"InteractiveObject.removeFromGroup() must be a string of 1 or more characters";delete this._groups[t.toLowerCase()]},Object.defineProperty(InventoryData.prototype,"io",{get(){return this._io},set(t){if(null==t||!(t instanceof this.IoClass))throw"InventoryData.io - parameter must be an instance of InteractiveObject";this._io=t,void 0!==this._io.inventory&&null!==this._io.inventory||(this._io.inventory=this)}}),InventoryData.prototype.canBePutInInventory=function(t){if(!this.InteractiveInstance.isValidIo(t))throw"InventoryData.canBePutInInventory() requires a valid IO";for(var e=!1,r=!1,a=this._slots.length-1;a>=0;a--){null!=(i=this._slots[a].io)&&i.data.stackSize>1&&this.InteractiveInstance.isSameObject(t,i)&&i.data.count<i.data.stackSize&&(e=!0,i.data.count+=t.data.count,i.data.count>i.data.stackSize?(t.data.count=i.data.count-i.data.stackSize,i.data.count=i.data.stackSize):(t.data.count=0,r=!0),0===t.data.count&&this.InteractiveInstance.releaseIo(t))}if(!r)for(a=this._slots.length-1;a>=0;a--){var i;if(null==(i=this._slots[a].io)){this._slots[a].io=t,this._slots[a].io.show=!0,this.declareInInventory(t),e=!0;break}}return e},InventoryData.prototype.cleanInventory=function(){for(var t=this._slots.length-1;t>=0;t--)this._slots[t].io=null,this._slots[t].show=!0},InventoryData.prototype.declareInInventory=function(t){if(!this.InteractiveInstance.isValidIo(t))throw"InventoryData.declareInInventory() requires a valid IO";this.ScriptInstance.eventSender=t,this.ScriptInstance.sendIOScriptEvent({io:this._io,eventId:this.BaseConstants.SM_INVENTORYIN}),this.ScriptInstance.eventSender=this._io,this.ScriptInstance.sendIOScriptEvent({io:t,eventId:this.BaseConstants.SM_INVENTORYIN}),this.ScriptInstance.eventSender=null},InventoryData.prototype.init=function(){throw"InventoryData is abstract - you must create a definition for init() on the extending class's prototype"},InventoryData.prototype.isInInventory=function(t){if(!this.InteractiveInstance.isValidIo(t))throw"InventoryData.isInInventory() requires a valid IO";for(var e=!1,r=this._slots.length-1;r>=0;r--){var a=this._slots[r].io;if(null!=a&&t.equals(a)){e=!0;break}}return e},InventoryData.prototype.removeFromInventory=function(t){if(!this.InteractiveInstance.isValidIo(t))throw"InventoryData.removeFromInventory() requires a valid IO";for(var e=!1,r=this._slots.length-1;r>=0;r--){var a=this._slots[r].io;if(null!=a&&t.equals(a)){this._slots[r].io=null,this._slots[r].show=!0,e=!0;break}}return e},InventoryData.prototype.replaceInInventory=function(t,e){if(!this.InteractiveInstance.isValidIo(t))throw"InventoryData.replaceInInventory() requires a valid IO to be replaced";if(!this.InteractiveInstance.isValidIo(e))throw"InventoryData.replaceInInventory() requires an IO to replace with";for(var r=this._slots.length-1;r>=0;r--){var a=this._slots[r].io;if(null!=a&&this.InteractiveInstance.isSameObject(t,a)){this._slots[r].io=e,this._slots[r].show=!0;break}}},Object.defineProperty(InventorySlot.prototype,"io",{get(){return this._io},set(t){if(null!==t&&!this.InteractiveInstance.isValidIo(t))throw"InventorySlot.io must be either null or a valid IO";this._io=t}}),Object.defineProperty(InventorySlot.prototype,"show",{get(){return this._show},set(t){if("boolean"!=typeof t)throw"InventorySlot.show requires a boolean";this._show=t}}),Object.defineProperty(IoBehaviourData.prototype,"behaviourParam",{get(){return this._behaviourParam},set(t){if(isNaN(parseFloat(t)))throw"IoBehaviourData.behaviourParam requires a floating-point value";this._behaviourParam=t}}),Object.defineProperty(IoBehaviourData.prototype,"behaviour",{get(){return this._behaviour}}),Object.defineProperty(IoBehaviourData.prototype,"exists",{get(){return this._exists},set(t){if("boolean"!=typeof t)throw"IoBehaviourData.exists requires a boolean";this._exists=t}}),Object.defineProperty(IoBehaviourData.prototype,"moveMode",{get(){return this._moveMode},set(t){if(isNaN(parseInt(t)))throw"IoBehaviourData.moveMode requires an integer value";if(t<this.BaseConstants.WALKMODE||t>this.BaseConstants.SNEAKMODE)throw"IoBehaviourData.moveMode - '"+t+"' is not recognized";this._moveMode=t}}),Object.defineProperty(IoBehaviourData.prototype,"tactics",{get(){return this._tactics},set(t){if(isNaN(parseInt(t)))throw"IoBehaviourData.tactics requires an integer value";this._tactics=t}}),Object.defineProperty(IoBehaviourData.prototype,"target",{get(){return this._target},set(t){if(isNaN(parseInt(t)))throw"IoBehaviourData.target requires an integer value";if(t<0)throw"IoBehaviourData.target - '"+t+"' is not a valid IO target";this._target=t}}),IoBehaviourData.prototype.is=function(t){return this.behaviour.hasFlag(t)},IoEquipItem.prototype.free=function(){for(var t=this._elements.length-1;t>=0;t--)this._elements[t]=null},IoEquipItem.prototype.getElementModifier=function(t){if(isNaN(parseInt(t)))throw"IOEquipItem.getElementModifier() requires a valid element";if(t>=this._elements.length)for(var e=this._elements.length,r=t;e<=r;e++)this._elements.push(new this.EquipModifierClass);return this._elements[t]},Object.defineProperty(IoItemData.prototype,"count",{get(){return this._count},set(t){if(isNaN(parseInt(t)))throw"IoItemData.count requires an integer value";if(t<0)throw"IoItemData.count cannot be less than 0";this._count=t}}),Object.defineProperty(IoItemData.prototype,"foodValue",{get(){return this._food_value},set(t){if(isNaN(parseInt(t)))throw"IoItemData.foodValue requires an integer value";if(t<0)throw"IoItemData.foodValue cannot be less than 0";this._food_value=t}}),Object.defineProperty(IoItemData.prototype,"io",{get(){return this._io},set(t){if(!this.InteractiveInstance.isValidIo(t))throw"IoItemData.io parameter must be an instance of InteractiveObject";this._io=t,void 0!==this._io.data&&null!==this._io.data||(this._io.data=this)}}),Object.defineProperty(IoItemData.prototype,"lightValue",{get(){return this._lightValue},set(t){if(isNaN(parseInt(t)))throw"IoItemData.lightValue requires an integer value";this._lightValue=t}}),Object.defineProperty(IoItemData.prototype,"maxcount",{get(){return this._maxcount},set(t){if(isNaN(parseInt(t)))throw"IoItemData.maxcount requires an integer value";if(t<0)throw"IoItemData.maxcount cannot be less than 0";this._maxcount=t}}),Object.defineProperty(IoItemData.prototype,"price",{get(){return this._price},set(t){if(isNaN(parseInt(t)))throw"IoItemData.price requires an integer value";if(t<0)throw"IoItemData.price cannot be less than 0";this._price=t}}),Object.defineProperty(IoItemData.prototype,"stackSize",{get(){return this._stacksize},set(t){if(isNaN(parseInt(t)))throw"IoItemData.stackSize requires an integer value";if(t<0)throw"IoItemData.stackSize cannot be less than 0";this._stacksize=t}}),Object.defineProperty(IoItemData.prototype,"stealValue",{get(){return this._stealvalue},set(t){if(isNaN(parseInt(t)))throw"IoItemData.stealValue requires an integer value";this._stealvalue=t}}),Object.defineProperty(IoItemData.prototype,"typeFlags",{get(){return this._typeFlags}}),IoItemData.prototype.free=function(){for(var t=this._elements.length-1;t>=0;t--)this._elements[t]=null},IoItemData.prototype.getElementModifier=function(t){if(isNaN(parseInt(t)))throw"IOEquipItem.getElementModifier() requires a valid element";if(t>=this._elements.length)for(var e=this._elements.length,r=t;e<=r;e++)this._elements.push(new this.EquipModifierClass);return this._elements[t]},IoItemData.prototype.init=function(){throw"IoItemData.init() must be implemented in an extended class. Check ../tests/samples for an example"},Object.defineProperty(IoNpcData.prototype,"io",{get(){return this._io},set(t){if(!this.InteractiveInstance.isValidIo(t))throw"IoNpcData.io parameter must be an instance of InteractiveObject";this._io=t,void 0!==this._io.data&&null!==this._io.data||(this._io.data=this)}}),Object.defineProperty(IoNpcData.prototype,"life",{get(){throw"IoNpcData.life.get() called from abstract class. check ../tests/samples for an example"},set(t){throw"IoNpcData.life.set() called from abstract class. check ../tests/samples for an example"}}),Object.defineProperty(IoNpcData.prototype,"maxlife",{get(){throw"IoNpcData.maxlife.get() called from abstract class. check ../tests/samples for an example"},set(t){throw"IoNpcData.maxlife.set() called from abstract class. check ../tests/samples for an example"}}),Object.defineProperty(IoNpcData.prototype,"moveMode",{get(){return this._moveMode},set(t){if(isNaN(parseInt(t)))throw"IoNpcData.moveMode requires an integer value";if(t<this.BaseConstants.WALKMODE||t>this.BaseConstants.SNEAKMODE)throw"IoNpcData.moveMode - '"+t+"' is not recognized";this._moveMode=t}}),IoNpcData.prototype.changeBehaviour=function(t){if(!(t instanceof this.BehaviourClass))throw"IoNpcData.changeBehaviour() requires a valid behaviour";this._behaviour.is(this.BaseConstants.BEHAVIOUR_FIGHT)&&t.is(this.BaseConstants.BEHAVIOUR_FIGHT),this._behaviour.is(this.BaseConstants.BEHAVIOUR_NONE)&&t.is(this.BaseConstants.BEHAVIOUR_NONE),t.is(this.BaseConstants.BEHAVIOUR_FRIENDLY),this._behaviour=t},IoNpcData.prototype.isDead=function(){var t=!1;return this.life<=0&&(t=!0),t||"DEAD"===this.io.mainevent&&(t=!0),t},IoNpcData.prototype.resetBehaviour=function(){this._behaviour.behaviour.clear(),this._behaviour.behaviour.add(this.BaseConstants.BEHAVIOUR_NONE);for(var t=this._behaviours.length-1;t>=0;t--)this._behaviours[t].exist=!1},IoNpcData.prototype.revive=function(t){this._io.script.mainevent="MAIN",this.life=this.maxlife,this.ScriptInstance.resetObject(this._io)},IoNpcData.prototype.stackBehaviour=function(){for(var t=this._behaviours.length-1;t>=0;t--)if(!this._behaviours[t].exist){var e=this._behaviours[t];(e=this._behaviour).moveMode=this._moveMode,e.exist=!0}},IoNpcData.prototype.unstackBehaviour=function(){for(var t=this._behaviours.length-1;t>=0;t--)this._behaviours[t].exist&&(this._behaviour=this._behaviours[t])},Object.defineProperty(IoPcData.prototype,"gold",{get(){return this._gold},set(t){if(isNaN(parseFloat(t)))throw"IoPcData.gold parameter must be a float";this._gold=t,this._gold<0&&(this._gold=0)}}),Object.defineProperty(IoPcData.prototype,"io",{get(){return this._io},set(t){if(!this.InteractiveInstance.isValidIo(t))throw"IoPcData.io parameter must be an instance of InteractiveObject";this._io=t,void 0!==this._io.data&&null!==this._io.data||(this._io.data=this)}}),Object.defineProperty(IoPcData.prototype,"mana",{get(){throw"IoPcData.mana.get() called from abstract class"},set(t){throw"IoPcData.mana.set() called from abstract class"}}),Object.defineProperty(IoPcData.prototype,"maxmana",{get(){throw"IoPcData.maxmana.get() called from abstract class"},set(t){throw"IoPcData.maxmana.set() called from abstract class"}}),Object.defineProperty(IoPcData.prototype,"life",{get(){throw"IoPcData.life.get() called from abstract class"},set(t){throw"IoPcData.life.set() called from abstract class"}}),Object.defineProperty(IoPcData.prototype,"maxlife",{get(){throw"IoPcData.maxlife.get() called from abstract class"},set(t){throw"IoPcData.maxlife.set() called from abstract class"}}),Object.defineProperty(IoPcData.prototype,"attributes",{get(){return this._attributes}}),Object.defineProperty(IoPcData.prototype,"level",{get(){return this._level},set(t){if(isNaN(parseInt(t)))throw"IoPcData.level parameter must be an integer";this._level=t,this._level<0&&(this._level=0)}}),Object.defineProperty(IoPcData.prototype,"xp",{get(){return this._xp},set(t){if(isNaN(parseInt(t)))throw"IoPcData.xp parameter must be an integer";this._xp=t,this._xp<0&&(this._xp=0)}}),IoPcData.prototype._applyRulesModifiers=function(){throw"IoPcData._applyRulesModifiers() called from base prototype. Must override!"},IoPcData.prototype._applyRulesPercentModifiers=function(){throw"IoPcData._applyRulesPercentModifiers() called from base prototype. Must override!"},IoPcData.prototype._clearElementModifiers=function(){for(var t in this._attributes)this._attributes[t].clearModifiers()},IoPcData.prototype._computeStats=function(){},IoPcData.prototype._defineAttribute=function(t){if(!(t instanceof this.AttributeClass))throw"IoPcData.defineAttribute() requires an instance of PlayerAttribute";this._attributes[t.abbr]=t},IoPcData.prototype._getEquipmentModifiers=function(t){for(var e=0,r=this._equipped.length-1;r>=0;r--)if(this._equipped[r]>=0&&this.InteractiveInstance.validIONum(this._equipped[r])){var a=this.InteractiveInstance.getIo(this._equipped[r]);if(a.ioFlags.has(this.BaseConstants.IO_ITEM)){var i=a.data.getElementModifier(t);i.percent||(e+=i.value)}}return e},IoPcData.prototype._getEquipmentPercentModifiers=function(t,e){for(var r=0,a=this._equipped.length-1;a>=0;a--)if(this._equipped[a]>=0&&this.InteractiveInstance.validIONum(this._equipped[a])){var i=this.InteractiveInstance.getIo(this._equipped[a]);if(i.ioFlags.has(this.BaseConstants.IO_ITEM)){var s=i.data.getElementModifier(t);s.percent&&(r+=s.value)}}return r*e*this.BaseConstants.DIV100},IoPcData.prototype._init=function(){throw"IoPcData._defineAttributes() must be overwritten in the extended class"},IoPcData.prototype.adjustLife=function(t){this.life+=t,this.computeFullStats(),this.life>this.maxlife&&(this.life=this.maxlife),this.life<0&&(this.life=0),this.notifyWatchers()},IoPcData.prototype.becomesDead=function(){},IoPcData.prototype.computeFullStats=function(){for(var t in this._computeStats(),this._clearElementModifiers(),this._attributes){(e=this._attributes[t]).adjust(this._getEquipmentModifiers(e.elementModifier))}for(var t in this._applyRulesModifiers(),this._attributes){var e;(e=this._attributes[t]).adjust(this._getEquipmentPercentModifiers(e.elementModifier,e.fullValue))}this._applyRulesPercentModifiers()},IoPcData.prototype.equip=function(t){if(!this.InteractiveInstance.isValidIo(t))throw"IoPcData.equip() requires a valid IO";this.InteractiveInstance.removeFromAllInventories(t);var e=this.BaseConstants.EQUIP_SLOT_WEAPON;if(t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_DAGGER)||t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_1H)||t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_2H)||t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_BOW))this._equipped[e]>=0&&this.InteractiveInstance.validIONum(this._equipped[e])&&this.unequip(this.InteractiveInstance.getIo(this._equipped[e])),this._equipped[e]=t.refId,(t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_2H)||t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_BOW))&&(e=this.BaseConstants.EQUIP_SLOT_SHIELD,this._equipped[e]>=0&&this.InteractiveInstance.validIONum(this._equipped[e])&&this.unequip(this.InteractiveInstance.getIo(this._equipped[e])));else if(t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_SHIELD)){if(e=this.BaseConstants.EQUIP_SLOT_SHIELD,this._equipped[e]>=0&&this.InteractiveInstance.validIONum(this._equipped[e])&&this.unequip(this.InteractiveInstance.getIo(this._equipped[e])),this._equipped[e]=t.refId,e=this.BaseConstants.EQUIP_SLOT_WEAPON,this._equipped[e]>=0&&this.InteractiveInstance.validIONum(this._equipped[e])){var r=this.InteractiveInstance.getIo(this._equipped[e]);(r.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_2H)||r.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_BOW))&&this.unequip(r)}}else if(t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_RING))e=this.BaseConstants.EQUIP_SLOT_RING_LEFT,this._equipped[e]>=0&&this.InteractiveInstance.validIONum(this._equipped[e])&&(e=this.BaseConstants.EQUIP_SLOT_RING_RIGHT),this._equipped[e]>=0&&this.InteractiveInstance.validIONum(this._equipped[e])&&(e=this.BaseConstants.EQUIP_SLOT_RING_LEFT),this._equipped[e]>=0&&this.InteractiveInstance.validIONum(this._equipped[e])&&this.unequip(this.InteractiveInstance.getIo(this._equipped[e])),this._equipped[e]=t.refId;else{if(!(t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_ARMOR)||t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_LEGGINGS)||t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_HELMET)))throw"IoPcData.equip() cannot equip unrecognized object type";t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_ARMOR)&&(e=this.BaseConstants.EQUIP_SLOT_ARMOR),t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_LEGGINGS)&&(e=this.BaseConstants.EQUIP_SLOT_LEGGINGS),t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_HELMET)&&(e=this.BaseConstants.EQUIP_SLOT_HELMET),this._equipped[e]>=0&&this.InteractiveInstance.validIONum(this._equipped[e])&&this.unequip(this.InteractiveInstance.getIo(this._equipped[e])),this._equipped[e]=t.refId,this.recreateMesh()}this.computeFullStats()},IoPcData.prototype.getWeaponType=function(){var t=this.BaseConstants.WEAPON_BARE;if(this._equipped[this.BaseConstants.EQUIP_SLOT_WEAPON]>=0&&this.InteractiveInstance.validIONum(this._equipped[this.BaseConstants.EQUIP_SLOT_WEAPON])){var e=this.InteractiveInstance.getIo(this._equipped[this.BaseConstants.EQUIP_SLOT_WEAPON]);e.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_DAGGER)&&(t=this.BaseConstants.WEAPON_DAGGER),e.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_1H)&&(t=this.BaseConstants.WEAPON_1H),e.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_2H)&&(t=this.BaseConstants.WEAPON_2H),e.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_BOW)&&(t=this.BaseConstants.WEAPON_BOW)}return t},IoPcData.prototype.hasEquipped=function(t){if(!this.InteractiveInstance.isValidIo(t))throw"IoPcData.hasEquipped() requires a valid IO";for(var e=!1,r=this._equipped.length-1;r>=0;r--)this._equipped[r]>=0&&this.InteractiveInstance.validIONum(this._equipped[r])&&this.InteractiveInstance.getIo(this._equipped[r]).equals(t)&&(e=!0);return e},IoPcData.prototype.levelUp=function(){this._level++,this._computeStats(),this.ScriptInstance.sendIOScriptEvent({io:this._io,eventName:"LEVEL_UP"})},IoPcData.prototype.putInFrontOfPlayer=function(t,e){throw"IoPcData.putInFrontOfPlayer() must be overriden in th extending class"},IoPcData.prototype.quickGeneration=function(){this._computeStats()},IoPcData.prototype.recreateMesh=function(){throw"IoPcData.recreateMesh() must be overriden in th extending class"},IoPcData.prototype.releaseEquippedIo=function(t){for(var e=this._equipped.length-1;e>=0;e--)this._equipped[e]===t&&(this._equipped[e]=-1)},IoPcData.prototype.unequip=function(t,e){if(void 0===e&&(e=!1),!this.InteractiveInstance.isValidIo(t))throw"IoPcData.unequip() requires a valid IO";if(!this.hasEquipped(t))throw"IoPcData.unequip() item was not equipped";for(var r=this._equipped.length-1;r>=0;r--)this._equipped[r]===t.refId&&(this._equipped[r]=-1,e||this._io.inventory.canBePutInInventory(t)||this.putInFrontOfPlayer(t,1),this.ScriptInstance.eventSender=t,this.ScriptInstance.sendIOScriptEvent({io:this._io,eventId:this.BaseConstants.SM_EQUIPOUT}),this.ScriptInstance.eventSender=this._io,this.ScriptInstance.sendIOScriptEvent({io:t,eventId:this.BaseConstants.SM_EQUIPOUT}));(t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_HELMET)||t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_ARMOR)||t.data.typeFlags.has(this.BaseConstants.OBJECT_TYPE_LEGGINGS))&&this.recreateMesh(),this.computeFullStats()},IoPcData.prototype.unequipAll=function(){for(var t=this._equipped.length-1;t>=0;t--)this._equipped[t]>=0&&this.InteractiveInstance.validIONum(this._equipped[t])&&this.unequip(this.InteractiveInstance.getIo(this._equipped[t]));this.computeFullStats()},Object.defineProperty(IoScript.prototype,"allowedEvents",{get(){return this._allowedEvents}}),Object.defineProperty(IoScript.prototype,"io",{get(){return this._io},set(t){if(!this.InteractiveInstance.isValidIo(t))throw"IO parameter must be an instance of InteractiveObject";this._io=t,null===this._io.script&&(this._io.script=this)}}),Object.defineProperty(IoScript.prototype,"master",{get(){return this._master},set(t){if(null==t||!(t instanceof IoScript))throw"master parameter must be an instance of IoScript";this._master=t,this._master.io=this._io}}),IoScript.prototype.addAction=function(t,e){if(void 0===t||void 0===e)throw"need key-value pair when setting script actions";if("string"!=typeof t)throw"action name must be a string";if(0===t.length)throw"action name cannot be an empty string";if(!(e instanceof this.ActionClass))throw"action must be an instance of ScriptAction";this._actions[t]=e},IoScript.prototype.clearVariables=function(){for(var t in this._variables)delete this._variables[t]},IoScript.prototype.execute=function(t,e){if(!this._actions.hasOwnProperty(t))throw["IoScript.execute() - Missing action '",t,"'"].join("");return this._actions[t].execute(e)},IoScript.prototype.getVariable=function(t,e){if(!this._variables.hasOwnProperty(t))throw["Missing variable '",t,"'"].join("");return this._variables[t]},IoScript.prototype.hasVariable=function(t){return this._variables.hasOwnProperty(t)},IoScript.prototype.setVariable=function(t,e){if(void 0===t||void 0===e)throw"need key-value pair when setting script variables";if("string"!=typeof t)throw"key must be a string";if(0===t.length)throw"key cannot be an empty string";this._variables[t]=e},Object.defineProperty(IoSpellData.prototype,"id",{get(){return this._spellId},set(t){if(isNaN(parseInt(t)))throw"IoSpellData.id requires an integer value";if(t<0)throw"IoSpellData.id - '"+t+"' is not a valid IO target";this._spellId=t}}),Object.defineProperty(IoSpellData.prototype,"duration",{get(){return this._duration},set(t){if(isNaN(parseInt(t)))throw"IoSpellData.duration requires an integer value";if(t<0)throw"IoSpellData.duration requires a positive integer value";this._duration=t}}),Object.defineProperty(IoSpellData.prototype,"flags",{get(){return this._flags}}),Object.defineProperty(IoSpellData.prototype,"level",{get(){return this._level},set(t){if(isNaN(parseInt(t)))throw"IoSpellData.level requires an integer value";if(t<0)throw"IoSpellData.level requires a positive integer value";this._level=t}}),Object.defineProperty(IoSpellData.prototype,"target",{get(){return this._target},set(t){if(isNaN(parseInt(t)))throw"IoSpellData.target requires an integer value";if(t<0)throw"IoSpellData.target - '"+t+"' is not a valid IO target";this._target=t}}),Location.prototype.equals=function(t){var e=!1;return t instanceof Location&&(e=this._x===t._x&&this._y===t._y),e},Object.defineProperty(Location.prototype,"x",{get(){return this._x},set(t){if(isNaN(parseInt(t)))throw"Location.x requires a valid number";this._x=t}}),Object.defineProperty(Location.prototype,"y",{get(){return this._y},set(t){if(isNaN(parseInt(t)))throw"Location.y requires a valid number";this._y=t}}),Location.prototype.set=function(t){if((t=null!=t?t:[0,0])instanceof Location)this._x=t._x,this._y=t._y;else if(Array.isArray(t))this._x=t[0],this._y=t[1];else{if(!("string"==typeof t&&t.indexOf(",")>0))throw"Location.set() requires a Location or two numbers";var e=t.split(",");this._x=parseInt(e[0]),this._y=parseInt(e[1])}},Location.prototype.toString=function(){var t=[];return t.push(this._x),t.push(", "),t.push(this._y),t.join("")},Location.prototype.translate=function(t,e){if(void 0===t||void 0===e)throw"Location.translate() requires two numbers";if(isNaN(parseInt(t))||isNaN(parseInt(e)))throw"Location.translate() requires two numbers";this._x+=t,this._y+=e};var AttributeLookupTable=function(t){this._attribute=t.attribute,this._entries=t.entries};AttributeLookupTable.prototype.findValue=function(t){for(var e,r=t.attributes[this._attribute].fullValue,a=!1,i=this._entries.length-1;i>=0;i--)if(this._entries[i].isInRange(r)){e=this._entries[i]._value,a=!0;break}if(!a)throw["Unable to find value in Attribute lookup table for ",this._attribute," value ",r].join("");return"function"==typeof e&&(e=e(t)),e};var VariableKeyTableEntry=function(t){switch(this._key=t.key,t.hasOwnProperty("valueType")||(t.valueType="int",t.value.hasOwnProperty("args")&&t.value.hasOwnProperty("body")&&(t.valueType="function"),Array.isArray(t.value)&&(t.valueType="array")),this._valueType=t.valueType,t.valueType){case"array":case"dictionary":case"int":case"float":case"Number":case"string":case"object":this._value=t.value;break;case"table":case"lookup_table":this._value=[];for(var e=0,r=t.value.length;e<r;e++)this._value.push(new VariableKeyTableEntry(t.value[e]));break;case"function":this._value=new Function(t.value.args,t.value.body);break;default:throw["unrecognized value type ",t.valueType].join("")}};function PlayerAttribute(t){if(!(t instanceof PlayerAttributeDescriptors))throw console.trace(t),"PlayerAttribute() requires a parameter object";this._descriptors=t,this._base=0,this._mod=0}function PlayerAttributeDescriptors(t){if(void 0===t)throw"PlayerAttributeDescriptors() requires a parameter object";if("string"!=typeof t.abbr||0===t.abbr.length)throw"PlayerAttributeDescriptors() requires an abbreviation";if("string"!=typeof t.description||0===t.description.length)throw console.trace(t),"PlayerAttributeDescriptors() requires a description";if("string"!=typeof t.title||0===t.title.length)throw"PlayerAttributeDescriptors() requires a title";if(isNaN(parseInt(t.elementModifier)))throw"PlayerAttributeDescriptors() requires an integer element modifier id";this._abbr=t.abbr,this._description=t.description,this._elementModifier=t.elementModifier,this._title=t.title}function ScriptAction(t){if(this._callback=null,void 0!==t){if(null===t)throw"ScriptAction() - callback parameter is null";if("function"!=typeof t)throw"ScriptAction() - callback parameter must be a function";this._callback=t}}function ScriptTimer(t){if(void 0===this.FlagSetClass)throw"IoBehaviourData() a FlagSetClass must be set on the IoBehaviourData.prototype before instantiation";if(void 0===this.InteractiveInstance)throw"IoNpcData() a InteractiveInstance must be set on the IoPcData.prototype before instantiation";if(void 0===this.ScriptClass)throw"ScriptTimer() a ScriptClass must be set on the ScriptTimer.prototype before instantiation";this._eventId,this._eventName,this._exists=!1,this._flags=new this.FlagSetClass,this._interval,this._io,this._name="",this._script=null,this._times=1,this._tim,void 0!==t&&this.set(t)}function StackedEvent(t){if(void 0===this.InteractiveInstance)throw"StackedEvent() a InteractiveInstance must be set on the StackedEvent.prototype before instantiation";null!=t&&this.set(t),this._eventId,this._eventName,this._exists=!1,this._io,this._params,this._sender}function Watchable(){this._watchers=[]}function Watcher(){}function DijkstraUndirectedSearch(t,e){this._distTo,this._edgeTo,this._pq;for(var r=t.numberOfEdges-1;r>=0;r--)if(t.getEdge(r).cost<0)throw["DijkstraUndirectedSearch.constructor() - edge has negative weight",t.getEdge(r)];this._distTo=t.numberOfVertices,this._edgeTo=[];r=0;for(var a=t.numberOfVertices;r<a;r++)this._edgeTo.push(null);for(var i=0;i<t.numberOfVertices;i++)this._distTo[i]=Number.POSITIVE_INFINITY;for(this._distTo[e]=0,this._pq=new IndexMinPQ(t.numberOfVertices),this._pq.insert(e,this._distTo[e]);!this._pq.isEmpty;){i=this._pq.delMin();var s=t.getVertexAdjacencies(i);for(r=s.Length-1;r>=0;r--)this.relax(s[r],i)}this.check(t,e)}function EdgeWeightedUndirectedGraph(t){if(this._edges,this._vertices,isNaN(parseInt(t))){this._vertices=[],this._edges=[];for(let e=0,r=t._vertices.length;e<r;e++)this._vertices.push(new GraphNode(t._vertices[e]));for(let e=0,r=t._edges.length;e<r;e++)this._edges.push(new WeightedGraphEdge(t._edges[e].index))}else{this._vertices=[];for(let e=t-1;e>=0;e--)this._vertices.push(new GraphNode(e));this._edges=[]}}function GraphEdge(t,e){if(this._from,this._to,this._debug=!1,void 0===t)throw this._debug&&console.trace(),"GraphEdge constructor requires at least one parameter object";if(Array.isArray(t)){if(2!==t.length)throw this._debug&&console.trace(t),"GraphEdge constructor was supplied an array that did not have two integer values";if(isNaN(parseInt(t[0]))||isNaN(parseInt(t[1])))throw this._debug&&console.trace(t),"GraphEdge constructor requires two integer values";this._from=t[0],this._to=t[1]}else if(isNaN(parseInt(t))){if(isNaN(parseInt(t.from))||isNaN(parseInt(t.to)))throw this._debug&&console.trace(t),"GraphEdge constructor requires two integer values";this._from=t.from,this._to=t.to}else{if(isNaN(parseInt(e)))throw this._debug&&console.trace(t,e),"GraphEdge constructor requires two integer values";this._from=t,this._to=e}}function WeightedGraphEdge(t){if(void 0===t)throw console.trace(),"WeightedGraphEdge constructor requires at least a parameter object";GraphEdge.apply(this,[t]),this._cost=isNaN(parseFloat(t.cost))?1:parseFloat(t.cost)}function GraphNode(t,e){if(this._index=-1,this._name,void 0===t)throw console.trace(),"GraphNode constructor requires at least one parameter object";if(Array.isArray(t)){if(1!==t.length&&2!==t.length)throw console.trace(t),"GraphNode constructor was supplied an array that did not have one or two values";if(isNaN(parseInt(t[0])))throw console.trace(t),"GraphNode constructor requires an integer value";if(void 0!==t[1]){if("string"!=typeof t[1]&&!(t[1]instanceof String))throw console.trace(t),"GraphNode constructor requires a string for the name";this._name=t[1]}this._index=parseInt(t[0])}else if(isNaN(parseInt(t))){if(isNaN(parseInt(t.index)))throw console.trace(t),"GraphNode constructor requires an integer value";if(this._index=parseInt(t.index),void 0!==t.name){if("string"!=typeof t.name&&!(t.name instanceof String))throw console.trace(t),"GraphNode constructor requires a string for the name";this._name=t.name}}else{if(void 0!==e){if("string"!=typeof e&&!(e instanceof String))throw console.trace(e),"GraphNode constructor requires a string for the name";this._name=e}this._index=parseInt(t)}}function HexCoordinateSystem(t){if(isNaN(parseInt(t)))throw["HexCoordinateSystem constructor requires an integer",t];if(parseInt(t)<ODD_R||parseInt(t)>EVEN_Q)throw["HexCoordinateSystem constructor requires an integer between 0 and 3",t];this._hexes=[],this._nextId=0,this._offsetConfiguration=parseInt(t)}Object.defineProperty(VariableKeyTableEntry.prototype,"value",{get(){return this._value}}),VariableKeyTableEntry.prototype.isInRange=function(t){if(void 0===t)throw"VariableKeyTableEntry.isInRange() requires an integer argument";return Array.isArray(this._key)?this._key[0]<=t&&t<=this._key[1]:this._key===t},Object.defineProperty(PlayerAttribute.prototype,"abbr",{get(){return this._descriptors.abbr}}),Object.defineProperty(PlayerAttribute.prototype,"description",{get(){return this._descriptors.description}}),Object.defineProperty(PlayerAttribute.prototype,"elementModifier",{get(){return this._descriptors.elementModifier}}),Object.defineProperty(PlayerAttribute.prototype,"title",{get(){return this._descriptors.title}}),Object.defineProperty(PlayerAttribute.prototype,"baseValue",{get(){return this._base},set(t){if(isNaN(parseFloat(t)))throw console.trace(t),"PlayerAttribute.baseValue must be a floating-point value";this._base=t}}),Object.defineProperty(PlayerAttribute.prototype,"fullValue",{get(){return this._base+this._mod}}),PlayerAttribute.prototype.adjust=function(t){if(isNaN(parseFloat(t)))throw console.trace(t),"PlayerAttribute.adjust() requires a floating-point value";this._mod+=t},PlayerAttribute.prototype.clearModifiers=function(){this._mod=0},Object.defineProperty(PlayerAttributeDescriptors.prototype,"abbr",{get(){return this._abbr}}),Object.defineProperty(PlayerAttributeDescriptors.prototype,"description",{get(){return this._description}}),Object.defineProperty(PlayerAttributeDescriptors.prototype,"elementModifier",{get(){return this._elementModifier}}),Object.defineProperty(PlayerAttributeDescriptors.prototype,"title",{get(){return this._title}}),Object.defineProperty(ScriptAction.prototype,"callback",{set(t){if(void 0===t)throw"No callback was provided";if(null===t)throw"callback parameter is null";if("function"!=typeof t)throw"Callback must be a function";this._callback=t}}),ScriptAction.prototype.execute=function(t){return this._callback(t)},ScriptTimer.prototype.clear=function(){this._name="",this._exists=!1},ScriptTimer.prototype.equals=function(t){var e=!1;return t instanceof ScriptTimer&&(e=this._name.toLowerCase()===t._name.toLowerCase()),e},ScriptTimer.prototype.set=function(t){if(void 0===t)throw"ScriptTimer.set() requires a parameter object";this.exists=!0,t.hasOwnProperty("flags")&&(this._flags=flags),this.interval=t.interval,this.io=t.io,this.script=t.script,t.hasOwnProperty("times")&&(this.times=t.times)},Object.defineProperty(ScriptTimer.prototype,"exists",{get(){return this._exists},set(t){if("boolean"!=typeof t)throw"ScriptTimer.exists requires a boolean";this._exists=t}}),Object.defineProperty(ScriptTimer.prototype,"flags",{get(){return this._flags}}),Object.defineProperty(ScriptTimer.prototype,"interval",{get(){return this._interval},set(t){if(isNaN(parseInt(t))||parseInt(t)<0)throw"ScriptTimer.interval requires a positive integer";this._interval=t}}),Object.defineProperty(ScriptTimer.prototype,"io",{get(){return this._io},set(t){if(!this.InteractiveInstance.isValidIo(t))throw"ScriptTimer.io parameter must be an instance of InteractiveObject";this._io=t}}),Object.defineProperty(ScriptTimer.prototype,"eventId",{get(){return this._eventId},set(t){if(isNaN(parseInt(t))||parseInt(t)<0)throw"ScriptTimer.eventId requires a positive integer";this._eventId=t}}),Object.defineProperty(ScriptTimer.prototype,"eventName",{get(){return this._eventName},set(t){if("string"!=typeof t||0===t.length)throw"ScriptTimer.eventName requires a name of one or more characters";this._eventName=t}}),Object.defineProperty(ScriptTimer.prototype,"name",{get(){return this._name},set(t){if("string"!=typeof t||0===t.length)throw"ScriptTimer.name requires a name of one or more characters";this._name=t}}),Object.defineProperty(ScriptTimer.prototype,"script",{get(){return this._script},set(t){if(null==t||!(t instanceof this.ScriptClass))throw"ScriptTimer.script - script parameter must be an instance of IoScript";this._script=t}}),Object.defineProperty(ScriptTimer.prototype,"tim",{get(){return this._tim},set(t){if(isNaN(parseInt(t))||parseInt(t)<0)throw"ScriptTimer.tim requires a positive integer";this._tim=t}}),Object.defineProperty(ScriptTimer.prototype,"times",{get(){return this._times},set(t){if(isNaN(parseInt(t))||parseInt(t)<0)throw"ScriptTimer.times requires a positive integer";this._times=t}}),StackedEvent.prototype.clear=function(){this._eventId=0,this._eventName=null,this._exists=!1,this._io=null,this._params=null,this._sender=null},StackedEvent.prototype.set=function(t){if(!t.hasOwnProperty("eventId")&&!t.hasOwnProperty("eventName"))throw"StackedEvent.set() needs either an event id or name";t.hasOwnProperty("eventId")&&(this.eventId=t.eventId),t.hasOwnProperty("eventName")&&(this.eventName=t.eventName),this.exists=t.exists,this.io=t.io,this.params=t.params,this.sender=t.sender},Object.defineProperty(StackedEvent.prototype,"eventId",{get(){return this._eventId},set(t){if(isNaN(parseInt(t)))throw"StackedEvent.eventId requires an integer";this._eventId=t}}),Object.defineProperty(StackedEvent.prototype,"eventName",{get(){return this._eventName},set(t){if("string"==typeof t)throw"StackedEvent.eventName requires a string";this._eventName=t}}),Object.defineProperty(StackedEvent.prototype,"exists",{get(){return this._exists},set(t){if("boolean"==typeof t)throw"StackedEvent.exists requires a boolean";this._exists=t}}),Object.defineProperty(StackedEvent.prototype,"io",{get(){return this._io},set(t){if(!this.InteractiveInstance.isValidIo(t))throw"StackedEvent.io parameter must be an instance of InteractiveObject";this._io=t}}),Object.defineProperty(StackedEvent.prototype,"params",{get(){return this._params},set(t){this._params=t}}),Object.defineProperty(StackedEvent.prototype,"sender",{get(){return this._sender},set(t){if(!this.InteractiveInstance.isValidIo(t))throw"StackedEvent.sender parameter must be an instance of InteractiveObject";this._sender=t}}),Watchable.prototype.addWatcher=function(t){if(null!=t){let e=!1;for(let r=this._watchers.length-1;r>=0;r--)if(this._watchers[r]===t){e=!0;break}e||this._watchers.push(t)}},Watchable.prototype.notifyWatchers=function(){for(let t=this._watchers.length-1;t>=0;t--)this._watchers[t].watchUpdated(this)},Watchable.prototype.removeWatcher=function(t){let e=-1;for(let r=this._watchers.length-1;r>=0;r--)if(this._watchers[r]===t){e=r;break}e>-1&&this._watchers.splice(e,1)},Watcher.prototype.watchUpdated=function(t){},DijkstraUndirectedSearch.prototype.check=function(t,e){for(var r=t.numberOfEdges-1;r>=0;r--){if((o=t.getEdge(r)).cost<0)return console.log("DijkstraUndirectedSearch.check() - negative edge weight detected"),!1}if(0!==this._distTo[e]||null!==this._edgeTo[e])return console.log("DijkstraUndirectedSearch.check() - distTo[s] and edgeTo[s] inconsistent"),!1;for(var a=t.numberOfVertices-1;a>=0;a--)if(a!==e&&null===this._edgeTo[a]&&this._distTo[a]!==Number.POSITIVE_INFINITY)return console.log("DijkstraUndirectedSearch.check() - distTo[] and edgeTo[] inconsistent"),!1;for(a=t.numberOfVertices-1;a>=0;a--){var i=t.getVertexAdjacencies(a);for(r=i.Length-1;r>=0;r--){if(s=a===(o=i[r]).to?o.from:o.to,this._distTo[a]+o.cost<this._distTo[s])return console.log("DijkstraUndirectedSearch.check() - edge "+o+" not relaxed"),!1}}for(var s=0;s<t.numberOfVertices;s++)if(null!=this._edgeTo[s]){var o;a=(o=this._edgeTo[s]).from;if(s!==o.to)return!1;if(this._distTo[a]+o.cost!==this._distTo[s])return console.log("DijkstraUndirectedSearch.check() - edge "+o+" on shortest path not tight"),!1}return!0},DijkstraUndirectedSearch.prototype.distanceTo=function(t){return this._distTo[t]},DijkstraUndirectedSearch.prototype.hasPathTo=function(t){return this._distTo[t]<Number.POSITIVE_INFINITY},DijkstraUndirectedSearch.prototype.pathTo=function(t){var e=null;if(this.hasPathTo(t)){e=[];for(var r=this._edgeTo[t],a=t;null!==r;)e.push(r),r.from===a?(a=r.to,r=this._edgeTo[r.to]):(a=r.from,r=this._edgeTo[r.from])}return e},DijkstraUndirectedSearch.prototype.relax=function(t,e){var r,a;e===t.from?(r=t.From,a=t.to):(r=t.to,a=t.from),this._distTo[a]>this._distTo[r]+t.Cost&&(this._distTo[a]=this._distTo[r]+t.Cost,this._edgeTo[a]=t,this._pq.contains(a)?this._pq.decreaseKey(a,this._distTo[a]):this._pq.insert(a,this._distTo[a]))},Object.defineProperty(EdgeWeightedUndirectedGraph.prototype,"numberOfEdges",{get(){return this._edges.length}}),Object.defineProperty(EdgeWeightedUndirectedGraph.prototype,"numberOfVertices",{get(){let t=0;for(let e=this._vertices.length-1;e>=0;e--)this._vertices[e].index>-1&&t++;return t}}),EdgeWeightedUndirectedGraph.prototype.addEdge=function(t,e,r){let a,i,s=1;Array.isArray(t)?(a=t[0],i=t[1],s=t[2]):isNaN(parseInt(t.from))?(a=parseInt(t),i=parseInt(e),isNaN(parseFloat(r))||(s=parseFloat(r))):(a=t.from,i=t.to,s=t.cost),this.hasEdge(a,i)||(this.hasVertex(a)||this.addVertex(a),this.hasVertex(i)||this.addVertex(i),edges.push(new WeightedGraphEdge(a,i,s)))},EdgeWeightedUndirectedGraph.prototype.addVertex=function(t){let e=this.getEmptyVertexSlot();-1===e&&(e=this._vertices.Length,this.extendVerticesArray()),this._vertices[e]=new GraphNode(t)},EdgeWeightedUndirectedGraph.prototype.extendVerticesArray=function(t){isNaN(parseInt(t))&&(t=1);for(let e=parseInt(t);e>0;e--)this._vertices.push(null)},EdgeWeightedUndirectedGraph.prototype.getAdjacencies=function(t){let e=[];for(let r=this._edges.length-1;r>=0;r--)this._edges[r].from===t?e.push(this._edges[r].to):this._edges[r].to===t&&e.push(this._edges[r].from);return e},EdgeWeightedUndirectedGraph.prototype.getEdge=function(t,e){let r=null;if(Array.isArray(t)){let e=t[0],a=t[1];for(let t=this._edges.Length-1;t>=0;t--)if(this._edges[t].from==e&&this._edges[t].to==a||this._edges[t].from==a&&this._edges[t].to==e){r=this._edges[t];break}}else if(isNaN(parseInt(t))||isNaN(parseInt(e)))r=this._edges[parseInt(t)];else{let a=parseInt(t),i=parseInt(e);for(let t=this._edges.Length-1;t>=0;t--)if(this._edges[t].from==a&&this._edges[t].to==i||this._edges[t].from==i&&this._edges[t].to==a){r=this._edges[t];break}}return r},EdgeWeightedUndirectedGraph.prototype.getEmptyVertexSlot=function(){let t=-1;for(let e=0,r=this._vertices.Length;e<r;e++){if(null==this._vertices[e]){t=e;break}if(-1===this._vertices[e].index){t=e;break}}return t},EdgeWeightedUndirectedGraph.prototype.getVertex=function(t){let e=null;for(let r=this._vertices.Length-1;r>=0;r--)if(this._vertices[r].index==t){e=this._vertices[r];break}return e},EdgeWeightedUndirectedGraph.prototype.getVertexAdjacencies=function(t){let e=[];for(let t=this._edges.length-1;t>=0;t--)this._edges[t].from!=v&&this._edges[t].to!=v||e.push(this._edges[t]);return e},EdgeWeightedUndirectedGraph.prototype.hasEdge=function(t,e){let r=!1;if(Array.isArray(t)){let e=t[0],a=t[1];for(let t=this._edges.length-1;t>=0;t--){if(this._edges[t].from==e&&edges[t].to==a){r=!0;break}if(this._edges[t].from==a&&edges[t].to==e){r=!0;break}}}else if(isNaN(parseInt(t))||isNaN(parseInt(e))){for(let e=this._edges.length-1;e>=0;e--)if(this._edges[e].equalsUndirected(t)){r=!0;break}}else{let a=parseInt(t),i=parseInt(e);for(let t=this._edges.length-1;t>=0;t--){if(this._edges[t].from==a&&edges[t].to==i){r=!0;break}if(this._edges[t].from==i&&edges[t].to==a){r=!0;break}}}return r},EdgeWeightedUndirectedGraph.prototype.hasVertex=function(t){let e=!1;for(let r=this._vertices.length-1;r>=0;r--)if(this._vertices[r].index===t){e=!0;break}return e},EdgeWeightedUndirectedGraph.prototype.removeEdge=function(t,e){let r=!1;if(this.hasEdge(t,e)){let a;for(a=this._edges.length-1;a>=0&&!this._edges[a].equalsUndirected(t,e);a--);r=!0,this.edges.splice(index,1)}return r},Object.defineProperty(GraphEdge.prototype,"from",{get(){return this._from}}),Object.defineProperty(GraphEdge.prototype,"to",{get(){return this._to}}),GraphEdge.prototype.equalsDirected=function(t,e){var r=!1;if(r.toString(),void 0===t)throw this._debug&&console.trace(),"GraphEdge.equalsDirected() requires at least one parameter object";if(Array.isArray(t)){if(2!==t.length)throw this._debug&&console.trace(t),"GraphEdge.equalsDirected() was supplied an array that did not have two integer values";if(isNaN(parseInt(t[0]))||isNaN(parseInt(t[1])))throw this._debug&&console.trace(t),"GraphEdge.equalsDirected() requires two integer values";r=this._from===t[0]&&this._to===t[1]}else if(isNaN(parseInt(t))){if(isNaN(parseInt(t.from))||isNaN(parseInt(t.to)))throw this._debug&&console.trace(t),"GraphEdge.equalsDirected() requires two integer values";r=this._from===t.from&&this._to===t.to}else{if(isNaN(parseInt(e)))throw this._debug&&console.trace(t,e),"GraphEdge.equalsDirected() requires two integer values";r=this._from===t&&this._to===e}return r},GraphEdge.prototype.equalsUndirected=function(t,e){var r=!1;if(void 0===t)throw this._debug&&console.trace(),"GraphEdge.equalsUndirected() requires at least one parameter object";if(Array.isArray(t)){if(2!==t.length)throw this._debug&&console.trace(t),"GraphEdge.equalsUndirected() was supplied an array that did not have two integer values";if(isNaN(parseInt(t[0]))||isNaN(parseInt(t[1])))throw this._debug&&console.trace(t),"GraphEdge.equalsUndirected() requires two integer values";r=this._from===t[0]&&this._to===t[1]||this._to===t[0]&&this._from===t[1]}else if(isNaN(parseInt(t))){if(isNaN(parseInt(t.from))||isNaN(parseInt(t.to)))throw this._debug&&console.trace(t),"GraphEdge.equalsUndirected() requires two integer values";r=this._from===t.from&&this._to===t.to||this._to===t.from&&this._from===t.to}else{if(isNaN(parseInt(e)))throw this._debug&&console.trace(t,e),"GraphEdge.equalsUndirected() requires two integer values";r=this._from===t&&this._to===e||this._to===t&&this._from===e}return r},GraphEdge.prototype.toString=function(){return["[from=",this._from,",to=",this._to,"]"].join("")},WeightedGraphEdge.prototype=Object.create(GraphEdge.prototype),WeightedGraphEdge.prototype.constructor=WeightedGraphEdge,Object.defineProperty(WeightedGraphEdge.prototype,"cost",{get(){return this._cost}}),Object.defineProperty(GraphNode.prototype,"index",{get(){return this._index}}),Object.defineProperty(GraphNode.prototype,"name",{get(){return this._name}}),GraphNode.prototype.equals=function(t){if(void 0===t)throw console.trace(),"GraphNode.equals() requires at least a parameter object";var e=!1;if(isNaN(parseInt(t))){if(isNaN(parseInt(t.index)))throw console.trace(t),"GraphNode constructor requires an integer value";e=this._index===parseInt(t.index)}else e=this._index===parseInt(t);return e},Object.defineProperty(HexCoordinateSystem.prototype,"hexes",{get(){return this._hexes}}),Object.defineProperty(HexCoordinateSystem.prototype,"maxHexId",{get(){for(var t=0,e=this._h.Length-1;e>=0;e--)t=Math.max(t,_hexes[e].Id);return t}}),HexCoordinateSystem.prototype.addHexagon=function(t){if(void 0===t)throw console.trace(),"HexCoordinateSystem.addHexagon requires at least one argument";if(t.hasOwnProperty("q")&&t.hasOwnProperty("r")){let e=this.getHexagon(t.q,t.r);null===e&&(console.log(this),(e=new this.HexagonClass({id:this._nextId++,isFlat:t.isFlat})).setCoordinates(this.getCubeCoordinates({q:t.q,r:t.r})),this._hexes.push(e))}else{if(!t.hasOwnProperty("hex"))throw"FIX THIS!!";{switch(this._offsetConfiguration){case ODD_R:case EVEN_R:if(t.hex.isFlat)throw"Cannot have-flat topped hexagons with horizontal layout";break;case ODD_Q:case EVEN_Q:if(!parameterObjecthex.isFlat())throw"Cannot have pointy topped hexagons with vertical layout";break;default:throw["Invalid offset coordinates ",this._offsetConfiguration]}let e=this._hexes.length-1;for(;e>=0&&(null===this._hexes[e]||!this._hexes[e].equals(hex));e--);e>=0?this._hexes[e]=hex:this._hexes.push(hex),nextId<=hex.id&&(nextId=hex.id+1)}}},HexCoordinateSystem.prototype.distance=function(t,e){return(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z))/2},HexCoordinateSystem.prototype.getAxialCoordinates=function(t){let e,r;switch(this._offsetConfiguration){case EVEN_Q:e=t.x,r=t.z+(t.x+(1&t.x))/2;break;case ODD_Q:e=t.x,r=t.z+(t.x-(1&t.x))/2;break;case EVEN_R:e=t.x+(t.z+(1&t.z))/2,r=t.z;break;case ODD_R:e=t.x+(t.z-(1&t.z))/2,r=t.z;break;default:throw console.trace(),["HexCoordinateSystem.getAxialCoordinates() Invalid offset configuration ",this._offsetConfiguration]}return new SimpleVector2(e,r)},HexCoordinateSystem.prototype.getCubeCoordinates=function(t){let e;if(t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z"))e=new SimpleVector3(t.x,t.y,t.z);else if(t.hasOwnProperty("q")&&t.hasOwnProperty("r")){let r,a,i,s=t.q,o=t.r;switch(e=new SimpleVector3(0,0,0),this._offsetConfiguration){case EVEN_Q:a=-(r=s)-(i=o-(s+(1&s))/2);break;case ODD_Q:a=-(r=s)-(i=o-(s-(1&s))/2);break;case EVEN_R:a=-(r=s-(o+(1&o))/2)-(i=o);break;case ODD_R:a=-(r=s-(o-(1&o))/2)-(i=o);break;default:throw console.trace(),["HexCoordinateSystem.getCubeCoordinates() - Invalid offset configuration ",this._offsetConfiguration]}e.set(r,a,i)}return e},HexCoordinateSystem.prototype.getHexagon=function(t,e){for(var r=null,a=this.getCubeCoordinates({q:t,r:e}),i=this._hexes.length-1;i>=0;i--)if(this._hexes[i].equals(a)){r=this._hexes[i];break}return r};const COMPOUND_NEIGHBORS=[new SimpleVector3(4,5,-9),new SimpleVector3(9,-4,-5),new SimpleVector3(5,-9,4),new SimpleVector3(-4,-5,9),new SimpleVector3(-9,4,5),new SimpleVector3(-5,9,-4)],DIRECTION_N=0,DIRECTION_NNE=1,DIRECTION_E=2,DIRECTION_SSE=3,DIRECTION_S=4,DIRECTION_SSW=5,DIRECTION_W=6,DIRECTION_NNW=7,EVEN_Q=3,EVEN_R=1,NEIGHBORS=[[new SimpleVector3(1,0,-1),new SimpleVector3(1,-1,0),new SimpleVector3(0,-1,1),new SimpleVector3(-1,0,1),new SimpleVector3(-1,1,0),new SimpleVector3(0,1,-1)],[new SimpleVector3(1,0,-1),new SimpleVector3(1,-1,0),new SimpleVector3(0,-1,1),new SimpleVector3(-1,0,1),new SimpleVector3(-1,1,0),new SimpleVector3(0,1,-1)],[new SimpleVector3(0,1,-1),new SimpleVector3(1,0,-1),new SimpleVector3(1,-1,0),new SimpleVector3(0,-1,1),new SimpleVector3(-1,0,1),new SimpleVector3(-1,1,0)],[new SimpleVector3(0,1,-1),new SimpleVector3(1,0,-1),new SimpleVector3(1,-1,0),new SimpleVector3(0,-1,1),new SimpleVector3(-1,0,1),new SimpleVector3(-1,1,0)]],ODD_Q=2,ODD_R=0;function Hexagon(t){if(void 0===t)throw console.trace(),"Hexagon constructor requires a set of parameters";if(this._corners=[[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1]],this._edges=[-1,-1,-1,-1,-1,-1],this._flat=!0,this._height,this._horizontalDistance,this._id,this._size,this._verticalDistance,this._width,this._x,this._y,this._size,!t.hasOwnProperty("id")||isNaN(parseInt(t.id)))throw console.trace(t),"Hexagon constructor requires a setting for id";this._id=t.id,"boolean"==typeof t.isFlat&&(this._flat=t.isFlat),!isNaN(parseFloat(t.size))&&parseFloat(t.size)>0&&this.setSize(t.size)}function CompoundHexagon(t){if(void 0===t)throw console.trace(),"CompoundHexagon constructor requires a set of parameters";if(this._hexes=[],this._rotations=0,!t.hasOwnProperty("id")||isNaN(parseInt(t.id)))throw console.trace(t),"CompoundHexagon constructor requires a setting for id";Hexagon.call(this,t)}function IndexMinPQ(t){if(this._nmax,this._n,this._pq=[],this._qp=[],this._keys=[],isNaN(parseInt(t)))throw["IndexMinPQ.constructor requires an integer value",t];if(parseInt(t)<0)throw["IndexMinPQ.constructor requires a positive integer value",t];this._nmax=t;for(var e=0;e<=t;e++)this._qp.push(-1),this._pq.push(0),this._keys.push({})}function SimpleVector2(t,e){if(this._x,this._y,void 0===t)throw console.trace(),"SimpleVector2 constructor requires at least one parameter object";if(Array.isArray(t)){if(2!==t.length)throw console.trace(t),"SimpleVector2 constructor was supplied an array that did not have three values";if(isNaN(parseFloat(t))||isNaN(parseFloat(t[1])))throw console.trace(t),"SimpleVector2 constructor requires three integer values";this._x=parseFloat(t[0]),this._y=parseFloat(t[1])}else if(isNaN(parseFloat(t))){if(isNaN(parseFloat(t.x))||isNaN(parseFloat(t.y)))throw console.trace(t),"SimpleVector2 constructor requires two integer values";this._x=parseFloat(t.x),this._y=parseFloat(t.y)}else{if(isNaN(parseFloat(e)))throw console.trace(t,e),"SimpleVector2 constructor requires two flaoting-point values";this._x=parseFloat(t),this._y=parseFloat(e)}}function SimpleVector3(t,e,r){if(this._x,this._y,this._z,void 0===t)throw console.trace(),"SimpleVector3 constructor requires at least one parameter object";if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3 constructor was supplied an array that did not have three values";if(isNaN(parseFloat(t))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t),"SimpleVector3 constructor requires three integer values";this._x=parseFloat(t[0]),this._y=parseFloat(t[1]),this._z=parseFloat(t[2])}else if(isNaN(parseFloat(t))){if(isNaN(parseFloat(t.x))||isNaN(parseFloat(t.y))||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3 constructor requires three integer values";this._x=parseFloat(t.x),this._y=parseFloat(t.y),this._z=parseFloat(t.z)}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3 constructor requires three integer values";this._x=parseFloat(t),this._y=parseFloat(e),this._z=parseFloat(r)}}function AlignmentGrid(t){this._parent=null,this._cellWidth=0,this._cellHeight=0,this._parent=t.parent,this._cellWidth=this._parent.scale.width/t.columns,this._cellHeight=this._parent.scale.height/t.rows}function CardGame(){this._currentCards=[],this._discard=[],this._deck=[{suit:"CLUBS",rank:2,rankName:"2",name:"TWO OF CLUBS"},{suit:"CLUBS",rank:3,rankName:"3",name:"THREE OF CLUBS"},{suit:"CLUBS",rank:4,rankName:"4",name:"FOUR OF CLUBS"},{suit:"CLUBS",rank:5,rankName:"5",name:"FIVE OF CLUBS"},{suit:"CLUBS",rank:6,rankName:"6",name:"SIX OF CLUBS"},{suit:"CLUBS",rank:7,rankName:"7",name:"SEVEN OF CLUBS"},{suit:"CLUBS",rank:8,rankName:"8",name:"EIGHT OF CLUBS"},{suit:"CLUBS",rank:9,rankName:"9",name:"NINE OF CLUBS"},{suit:"CLUBS",rank:10,rankName:"10",name:"TEN OF CLUBS"},{suit:"CLUBS",rank:11,rankName:"J",name:"JACK OF CLUBS"},{suit:"CLUBS",rank:12,rankName:"Q",name:"QUEEN OF CLUBS"},{suit:"CLUBS",rank:13,rankName:"K",name:"KING OF CLUBS"},{suit:"CLUBS",rank:14,rankName:"A",name:"ACE OF CLUBS"},{suit:"DIAMONDS",rank:2,rankName:"2",name:"TWO OF DIAMONDS"},{suit:"DIAMONDS",rank:3,rankName:"3",name:"THREE OF DIAMONDS"},{suit:"DIAMONDS",rank:4,rankName:"4",name:"FOUR OF DIAMONDS"},{suit:"DIAMONDS",rank:5,rankName:"5",name:"FIVE OF DIAMONDS"},{suit:"DIAMONDS",rank:6,rankName:"6",name:"SIX OF DIAMONDS"},{suit:"DIAMONDS",rank:7,rankName:"7",name:"SEVEN OF DIAMONDS"},{suit:"DIAMONDS",rank:8,rankName:"8",name:"EIGHT OF DIAMONDS"},{suit:"DIAMONDS",rank:9,rankName:"9",name:"NINE OF DIAMONDS"},{suit:"DIAMONDS",rank:10,rankName:"10",name:"TEN OF DIAMONDS"},{suit:"DIAMONDS",rank:11,rankName:"J",name:"JACK OF DIAMONDS"},{suit:"DIAMONDS",rank:12,rankName:"Q",name:"QUEEN OF DIAMONDS"},{suit:"DIAMONDS",rank:13,rankName:"K",name:"KING OF DIAMONDS"},{suit:"DIAMONDS",rank:14,rankName:"A",name:"ACE OF DIAMONDS"},{suit:"HEARTS",rank:2,rankName:"2",name:"TWO OF HEARTS"},{suit:"HEARTS",rank:3,rankName:"3",name:"THREE OF HEARTS"},{suit:"HEARTS",rank:4,rankName:"4",name:"FOUR OF HEARTS"},{suit:"HEARTS",rank:5,rankName:"5",name:"FIVE OF HEARTS"},{suit:"HEARTS",rank:6,rankName:"6",name:"SIX OF HEARTS"},{suit:"HEARTS",rank:7,rankName:"7",name:"SEVEN OF HEARTS"},{suit:"HEARTS",rank:8,rankName:"8",name:"EIGHT OF HEARTS"},{suit:"HEARTS",rank:9,rankName:"9",name:"NINE OF HEARTS"},{suit:"HEARTS",rank:10,rankName:"10",name:"TEN OF HEARTS"},{suit:"HEARTS",rank:11,rankName:"J",name:"JACK OF HEARTS"},{suit:"HEARTS",rank:12,rankName:"Q",name:"QUEEN OF HEARTS"},{suit:"HEARTS",rank:13,rankName:"K",name:"KING OF HEARTS"},{suit:"HEARTS",rank:14,rankName:"A",name:"ACE OF HEARTS"},{suit:"SPADES",rank:2,rankName:"2",name:"TWO OF SPADES"},{suit:"SPADES",rank:3,rankName:"3",name:"THREE OF SPADES"},{suit:"SPADES",rank:4,rankName:"4",name:"FOUR OF SPADES"},{suit:"SPADES",rank:5,rankName:"5",name:"FIVE OF SPADES"},{suit:"SPADES",rank:6,rankName:"6",name:"SIX OF SPADES"},{suit:"SPADES",rank:7,rankName:"7",name:"SEVEN OF SPADES"},{suit:"SPADES",rank:8,rankName:"8",name:"EIGHT OF SPADES"},{suit:"SPADES",rank:9,rankName:"9",name:"NINE OF SPADES"},{suit:"SPADES",rank:10,rankName:"10",name:"TEN OF SPADES"},{suit:"SPADES",rank:11,rankName:"J",name:"JACK OF SPADES"},{suit:"SPADES",rank:12,rankName:"Q",name:"QUEEN OF SPADES"},{suit:"SPADES",rank:13,rankName:"K",name:"KING OF SPADES"},{suit:"SPADES",rank:14,rankName:"A",name:"ACE OF SPADES"}]}function UiScene(t){this._state,this._grid={columns:t.columns,rows:t.rows},this._setupComplete=!1,this._scene=t,t.hasOwnProperty("scene")&&(this._scene=t.scene),this._stateChangeResolved=!1,this._dynamicFields=function(){let t={};return{disableInteractive(e){if("string"!=typeof e&&!(e instanceof String))throw["Invalid key",e];if(!t.hasOwnProperty(e))throw["Invalid key",e];for(let r=t[e].length-1;r>=0;r--)t[e][r].disableInteractive()},put:function(e,r){if("string"!=typeof e&&!(e instanceof String))throw console.log(typeof e,e instanceof String),["Invalid key",e];if(void 0===r)throw["Invalid value",r];t.hasOwnProperty(e)||(t[e]=[]),t[e].push(r)},setAlpha(e,r,a,i,s){if("string"!=typeof e&&!(e instanceof String))throw["Invalid key",e];if(!t.hasOwnProperty(e))throw["Invalid key",e];for(let o=t[e].length-1;o>=0;o--)t[e][o].setAlpha(r,a,i,s)},setInteractive(e,r,a,i){if("string"!=typeof e&&!(e instanceof String))throw["Invalid key",e];if(!t.hasOwnProperty(e))throw["Invalid key",e];for(let s=t[e].length-1;s>=0;s--)t[e][s].setInteractive(r,a,i)},setText(e,r){if("string"!=typeof e&&!(e instanceof String))throw["Invalid key",e];if(!t.hasOwnProperty(e))throw["Invalid key",e];for(let a=t[e].length-1;a>=0;a--)t[e][a].setText(r)},setTint(e,r,a,i,s){if("string"!=typeof e&&!(e instanceof String))throw["Invalid key",e];if(!t.hasOwnProperty(e))throw["Invalid key",e];for(let o=t[e].length-1;o>=0;o--)t[e][o].setTint(r,a,i,s)}}}(),this._VIEWS={},this._KEY_UP_EVENT_HANDLERS={}}Object.defineProperty(Hexagon.prototype,"coordinates",{get(){return new this.VectorClass(this._x,this._y,this._z)}}),Object.defineProperty(Hexagon.prototype,"height",{get(){return this._height}}),Object.defineProperty(Hexagon.prototype,"id",{get(){return this._id}}),Object.defineProperty(Hexagon.prototype,"isFlat",{get(){return this._flat}}),Object.defineProperty(Hexagon.prototype,"size",{get(){return this._size}}),Object.defineProperty(Hexagon.prototype,"x",{get(){return this._x}}),Object.defineProperty(Hexagon.prototype,"y",{get(){return this._y}}),Object.defineProperty(Hexagon.prototype,"z",{get(){return this._z}}),Hexagon.prototype.copy=function(t){this._size=t.size,this._x=t.x,this._y=t.y,this._z=t.z},Hexagon.prototype.equals=function(t,e,r){if(void 0===t)throw console.trace(),"GraphNode.equals() requires at least a parameter object";let a=!1;if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"Hexagon.equals() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"Hexagon.equals() requires three floating-point values";a=this.coordinates.equals(t[0],t[1],t[2])}else if(isNaN(parseFloat(t)))a=t.hasOwnProperty("coordinates")?this.coordinates.equals(t.coordinates):this.coordinates.equals(t);else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"Hexagon.equals() requires three floating-point values";a=this.coordinates.equals(t,e,r)}return a},Hexagon.prototype.rotate=function(){this.coordinates.set(-this.coordinates.z,-this.coordinates.x,-this.coordinates.y)},Hexagon.prototype.setCoordinates=function(t){if(isNaN(parseFloat(t.x))||isNaN(parseFloat(t.y))||isNaN(parseFloat(t.z)))throw"Hexagon.setCoordinates requires a variable with 3 floating-point values";this._x=t.x,this._y=t.y,this._z=t.z},Hexagon.prototype.setCoordinatesOddQ=function(t,e){this._x=t,this._z=e-(t-(1&t))/2,this._y=-this._x-this._z},Hexagon.prototype.setCoordinatesOddR=function(t,e){this._x=t-(e-(1&e))/2,this._z=e,this._y=-this._x-this._z},Hexagon.prototype.setCoordinatesEvenQ=function(t,e){this._x=t,this._z=e-(t+(1&t))/2,this._y=-this._x-this._z},Hexagon.prototype.setCoordinatesEvenR=function(t,e){this._x=t-(e+(1&e))/2,this._z=e,this._y=-this._x-this._z},Hexagon.prototype.setSize=function(t){if(isNaN(parseFloat(t)))throw console.trace(t),"Hexagon.setSize requires a floating-point value";this._size=t,this._flat?(this._width=2*this._size,this._horizontalDistance=.75*this._width,this._height=float(Math.sqrt(3)/2*this._width),this._verticalDistance=this._height):(this._height=2*this._size,this._verticalDistance=.75*this._height,this._width=float(Math.sqrt(3)/2*this._height),this._horizontalDistance=this._width)},CompoundHexagon.prototype=Object.create(Hexagon.prototype),CompoundHexagon.prototype.constructor=Hexagon,Object.defineProperty(CompoundHexagon.prototype,"rotations",{get(){return this._rotations}}),Object.defineProperty(CompoundHexagon.prototype,"minX",{get(){let t=999999;for(let e=this._hexes.length-1;e>=0;e--)t=Math.min(t,this._hexes[e].x);return t}}),Object.defineProperty(CompoundHexagon.prototype,"maxX",{get(){let t=-999999;for(let e=this._hexes.length-1;e>=0;e--)t=Math.max(t,this._hexes[e].x);return t}}),Object.defineProperty(CompoundHexagon.prototype,"minY",{get(){let t=999999;for(let e=this._hexes.length-1;e>=0;e--)t=Math.min(t,this._hexes[e].y);return t}}),Object.defineProperty(CompoundHexagon.prototype,"maxY",{get(){let t=-999999;for(let e=this._hexes.length-1;e>=0;e--)t=Math.max(t,this._hexes[e].y);return t}}),CompoundHexagon.prototype.addHex=function(t){null!==t&&this._hexes.push(t)},CompoundHexagon.prototype.copy=function(t){if("CompoundHexagon"!=typeof hex||!(hex instanceof CompoundHexagon))throw["CompoundHexagon.copy requires an instance of CompoundHexagon"];Hexagon.prototype.copy.call(this,hex),this._rotations=hex.rotations,this._hexes.length=0;for(let t=0,e=hex._hexes.length;t<e;t++){let e=new Hexagon({isFlat:hex._hexes[t].isFlat,id:hex._hexes[t].id,size:hex._hexes[t].size});e.copy(hex._hexes[t]),this._hexes.push(e),e=null}},CompoundHexagon.prototype.getCenterHexagon=function(){let t=-999999,e=999999,r=-999999,a=999999,i=-999999,s=999999;for(let o=this._hexes.length-1;o>=0;o--)t=Math.max(t,this._hexes[o].x),e=Math.min(e,this._hexes[o].x),r=Math.max(r,this._hexes[o].y),a=Math.min(a,this._hexes[o].y),i=Math.max(i,this._hexes[o].z),s=Math.min(s,this._hexes[o].z);return this.getHexagon({x:(t+e)/2,y:(r+a)/2,z:(i+s)/2})},CompoundHexagon.prototype.getHexagon=function(t){if(t.hasOwnProperty("index"))return this._hexes[t.index];{let e=null;for(let r=this._hexes.length-1;r>=0;r--)this._hexes[r].equals(t.x,t.y,t.z)&&(e=this._hexes[r]);return e}},CompoundHexagon.prototype.getNumberOfHexes=function(){return this._hexes.length},CompoundHexagon.prototype.rotate=function(){for(let t=this._hexes.length-1;t>=0;t--)this._hexes[t].rotate();this._rotations++,this._rotations>5&&(this._rotations=0)},Object.defineProperty(IndexMinPQ.prototype,"count",{get(){return this._n}}),Object.defineProperty(IndexMinPQ.prototype,"isEmpty",{get(){return 0===this._n}}),Object.defineProperty(IndexMinPQ.prototype,"minIndex",{get(){if(this.isEmpty)throw"Priority queue underflow";return this._pq[1]}}),Object.defineProperty(IndexMinPQ.prototype,"minKey",{get(){if(0===this._n)throw"Priority queue underflow";return this._keys[this._pq[1]]}}),IndexMinPQ.prototype.change=function(t,e){this.changeKey(t,e)},IndexMinPQ.prototype.changeKey=function(t,e){if(isNaN(parseInt(nmax)))throw["IndexMinPQ.changeKey requires an integer value",t];if((t=parseInt(t))<0||t>=this._nmax)throw["IndexMinPQ.changeKey() - invalid index",t];if(!this.contains(t))throw"IndexMinPQ.changeKey() - index is not in the priority queue";this._keys[t]=e,this.swim(this._qp[t]),this.sink(this._qp[t])},IndexMinPQ.prototype.contains=function(t){if(isNaN(parseInt(nmax)))throw["IndexMinPQ.contains requires an integer value",t];if((t=parseInt(t))<0||t>=this._nmax)throw["IndexMinPQ.contains() - invalid index",t];return-1!=qp[t]},IndexMinPQ.prototype.delMin=function(){if(0==this._n)throw"Priority queue underflow";var t=this._pq[1];return this.exch(1,this._n--),this.sink(1),this._qp[t]=-1,this._keys[this._pq[this._n+1]]={},this._pq[this._n+1]=-1,t},IndexMinPQ.prototype.decreaseKey=function(t,e){if(isNaN(parseInt(nmax)))throw["IndexMinPQ.decreaseKey requires an integer value",t];if((t=parseInt(t))<0||t>=this._nmax)throw["IndexMinPQ.decreaseKey() - invalid index",t];if(!this.contains(t))throw"IndexMinPQ.decreaseKey() - index is not in the priority queue";if(this._keys[t]<=e)throw"IndexMinPQ.decreaseKey() - Calling DecreaseKey() with given argument would not strictly decrease the key";this._keys[t]=e,this.swim(this._qp[t])},IndexMinPQ.prototype.delete=function(t){if(isNaN(parseInt(nmax)))throw["IndexMinPQ.delete requires an integer value",t];if((t=parseInt(t))<0||t>=this._nmax)throw["IndexMinPQ.delete() - invalid index",t];if(!this.contains(t))throw"IndexMinPQ.delete() - index is not in the priority queue";var e=this._qp[t];this.exch(e,this._n--),this.swim(e),this.sink(e),this._keys[t]={},this._qp[t]=-1},IndexMinPQ.prototype.exch=function(t,e){var r=this._pq[t];this._pq[t]=this._pq[e],this._pq[e]=r,this._qp[this._pq[t]]=t,this._qp[this._pq[e]]=e},IndexMinPQ.prototype.greater=function(t,e){return this._keys[this._pq[t]]>this._keys[this._pq[e]]},IndexMinPQ.prototype.increaseKey=function(t,e){if(isNaN(parseInt(nmax)))throw["IndexMinPQ.decreaseKey requires an integer value",t];if((t=parseInt(t))<0||t>=this._nmax)throw["IndexMinPQ.decreaseKey() - invalid index",t];if(!this.contains(t))throw"IndexMinPQ.decreaseKey() - index is not in the priority queue";if(this._keys[t]>=e)throw"IndexMinPQ.decreaseKey() - Calling DecreaseKey() with given argument would not strictly decrease the key";this._keys[t]=e,this.sink(this._qp[t])},IndexMinPQ.prototype.insert=function(t,e){if(isNaN(parseInt(nmax)))throw["IndexMinPQ.insert requires an integer value",t];if((t=parseInt(t))<0||t>=this._nmax)throw["IndexMinPQ.insert() - invalid index",t];if(this.contains(t))throw["IndexMinPQ.insert() - index is already in the priority queue",t];this._n++,this._qp[t]=this._n,this._pq[this._n]=t,this._keys[t]=e,this.swim(this._n)},IndexMinPQ.prototype.keyOf=function(t){if(isNaN(parseInt(nmax)))throw["IndexMinPQ.keyOf requires an integer value",t];if((t=parseInt(t))<0||t>=this._nmax)throw["IndexMinPQ.keyOf() - invalid index",t];if(!this.contains(t))throw"IndexMinPQ.keyOf() - index is not in the priority queue";return this._keys[t]},IndexMinPQ.prototype.sink=function(t){for(;2*t<=this._n;){var e=2*t;if(e<this._n&&this.greater(e,e+1)&&e++,!this.greater(t,e))break;this.exch(t,e),t=e}},IndexMinPQ.prototype.swim=function(t){for(;t>1&&this.greater(t/2,t);)this.exch(t,t/2),t/=2},Object.defineProperty(SimpleVector2.prototype,"x",{get(){return this._x},set(t){if(isNaN(parseFloat(t)))throw console.trace(t),"SimpleVector2.x requires a Number value";this._x=parseFloat(t)}}),Object.defineProperty(SimpleVector2.prototype,"y",{get(){return this._y},set(t){if(isNaN(parseFloat(t)))throw console.trace(t),"SimpleVector2.y requires a Number value";this._y=parseFloat(t)}}),Object.defineProperty(SimpleVector2.prototype,"length",{get(){return Math.Sqrt(this._x*this._x+this._y*this._y)}}),SimpleVector2.prototype.distance=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector2.distance() requires at least one parameter object";let a;if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(2!==t.length)throw console.trace(t),"SimpleVector2.distance() was supplied an array that did not have two values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1])))throw console.trace(t,e),"SimpleVector2.distance() requires two integer values";a=Math.sqrt((t[0]-this._x)*(t[0]-this._x)+(t[1]-this._y)*(t[1]-this._y))}else{if(isNaN(parseFloat(t.x))||isNaN(parseFloat(t.y)))throw console.trace(t),"SimpleVector2.distance() requires two integer values";a=Math.sqrt((t.x-this._x)*(t.x-this._x)+(t.y-this._y)*(t.y-this._y))}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector2.distance() requires three integer values";a=Math.sqrt((t-this._x)*(t-this._x)+(e-this._y)*(e-this._y))}return a},SimpleVector2.prototype.equals=function(t,e){if(void 0===t)throw console.trace(),"GraphNode.equals() requires at least a parameter object";let r=!1;if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(2!==t.length)throw console.trace(t),"SimpleVector2.equals() was supplied an array that did not have two values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1])))throw console.trace(t,e),"SimpleVector2.equals() requires two Number values";r=this._x===t[0]&&this._y===t[1]}else{if(isNaN(parseFloat(t.x))||isNaN(parseFloat(t.y)))throw console.trace(t),"SimpleVector2.equals() requires two Number values";r=this._x===t.x&&this._y===t.y}else{if(isNaN(parseFloat(e)))throw console.trace(t,e),"SimpleVector3.equals() requires two Number values";r=this._x===t&&this._y===e}return r},SimpleVector2.prototype.set=function(t,e){if(void 0===t)throw console.trace(),"SimpleVector2.set() requires at least one parameter object";if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(2!==t.length)throw console.trace(t),"SimpleVector2.set() was supplied an array that did not have two values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1])))throw console.trace(t,e),"SimpleVector2.set() requires two integer values";this._x=t[0],this._y=e[1]}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y)))throw console.trace(t),"SimpleVector2.set() requires two integer values";this._x=t.x,this._y=t.y}else{if(isNaN(parseFloat(e)))throw console.trace(t,e),"SimpleVector2.set() requires two integer values";this._x=t,this._y=e}},SimpleVector2.prototype.toString=function(){return["[x=",this._x,",y=",this._y,"]"].join("")},Object.defineProperty(SimpleVector3.prototype,"x",{get(){return this._x}}),Object.defineProperty(SimpleVector3.prototype,"y",{get(){return this._y}}),Object.defineProperty(SimpleVector3.prototype,"z",{get(){return this._z}}),Object.defineProperty(SimpleVector3.prototype,"length",{get(){return Math.Sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}}),Object.defineProperty(SimpleVector3.prototype,"normal",{get(){let t;return t=0===this.length?0:1/this.length,new SimpleVector3(this._x*t,this._y*t,this._z*t)}}),SimpleVector3.prototype.minus=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.minus() requires at least one parameter object";let a;if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.minus() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.minus() requires three integer values";a=new SimpleVector3(this._x-parseFloat(t[0]),this._y-parseFloat(t[1]),this._z-parseFloat(t[2]))}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.plminusus() requires three integer values";a=new SimpleVector3(this._x-parseFloat(t.x),this._y-parseFloat(t.y),this._z-parseFloat(t.z))}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.minus() requires three integer values";a=new SimpleVector3(this._x-parseFloat(t),this._y-parseFloat(e),this._z-parseFloat(r))}return a},SimpleVector3.prototype.plus=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.plus() requires at least one parameter object";let a;if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.plus() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.plus() requires three integer values";a=new SimpleVector3(this._x+parseFloat(t[0]),this._y+parseFloat(t[1]),this._z+parseFloat(t[2]))}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.plus() requires three integer values";a=new SimpleVector3(this._x+parseFloat(t.x),this._y+parseFloat(t.y),this._z+parseFloat(t.z))}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.plus() requires three integer values";a=new SimpleVector3(this._x+parseFloat(t),this._y+parseFloat(e),this._z+parseFloat(r))}return a},SimpleVector3.prototype.crossProduct=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.crossProduct() requires at least one parameter object";let a;if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.crossProduct() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.crossProduct() requires three integer values";a=new SimpleVector3(this._y*parseFloat(t[2])-this._z*parseFloat(t[1]),this._z*parseFloat(t[0])-this._x*parseFloat(t[2]),this._x+parseFloat(t[1])-this._y*parseFloat(t[0]))}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.crossProduct() requires three integer values";a=new SimpleVector3(this._y*parseFloat(t.z)-this._z*parseFloat(t.y),this._z*parseFloat(t.x)-this._x*parseFloat(t.z),this._x+parseFloat(t.y)-this._y*parseFloat(t.x))}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.crossProduct() requires three integer values";a=new SimpleVector3(this._y*parseFloat(r)-this._z*parseFloat(e),this._z*parseFloat(t)-this._x*parseFloat(r),this._x+parseFloat(e)-this._y*parseFloat(t))}return a},SimpleVector3.prototype.decrement=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.decrement() requires at least one parameter object";if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.decrement() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.decrement() requires three integer values";this._x-=parseFloat(t[0]),this._y-=parseFloat(t[1]),this._z-=parseFloat(t[2])}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.decrement() requires three integer values";this._x-=parseFloat(t.x),this._y-=parseFloat(t.y),this._z-=parseFloat(t.z)}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.decrement() requires three integer values";this._x-=parseFloat(t),this._y-=parseFloat(e),this._z-=parseFloat(r)}},SimpleVector3.prototype.increment=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.increment() requires at least one parameter object";if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.increment() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.increment() requires three integer values";this._x+=parseFloat(t[0]),this._y+=parseFloat(t[1]),this._z+=parseFloat(t[2])}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.increment() requires three integer values";this._x+=parseFloat(t.x),this._y+=parseFloat(t.y),this._z+=parseFloat(t.z)}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.increment() requires three integer values";this._x+=parseFloat(t),this._y+=parseFloat(e),this._z+=parseFloat(r)}},SimpleVector3.prototype.distance=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.distance() requires at least one parameter object";let a;if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.distance() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.distance() requires three integer values";a=Math.sqrt((t[0]-this._x)*(t[0]-this._x)+(t[1]-this._y)*(t[1]-this._y))}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.distance() requires three integer values";a=Math.sqrt((t.x-this._x)*(t.x-this._x)+(t.y-this._y)*(t.y-this._y))}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.distance() requires three integer values";a=Math.sqrt((t-this._x)*(t-this._x)+(e-this._y)*(e-this._y))}return a},SimpleVector3.prototype.divide=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.divide() requires at least one parameter object";if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.divide() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.divide() requires three integer values";this._x/=parseFloat(t[0]),this._y/=parseFloat(t[1]),this._z/=parseFloat(t[2])}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.divide() requires three integer values";this._x/=parseFloat(t.x),this._y/=parseFloat(t.y),this._z/=parseFloat(t.z)}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.divide() requires three integer values";this._x/=parseFloat(t),this._y/=parseFloat(e),this._z/=parseFloat(r)}},SimpleVector3.prototype.multiply=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.multiply() requires at least one parameter object";if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.multiply() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.multiply() requires three integer values";this._x*=parseFloat(t[0]),this._y*=parseFloat(t[1]),this._z*=parseFloat(t[2])}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.multiply() requires three integer values";this._x*=parseFloat(t.x),this._y*=parseFloat(t.y),this._z*=parseFloat(t.z)}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.multiply() requires three integer values";this._x*=parseFloat(t),this._y*=parseFloat(e),this._z*=parseFloat(r)}},SimpleVector3.prototype.dotProduct=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.dotProduct() requires at least one parameter object";let a;if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.dotProduct() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.dotProduct() requires three integer values";a=this._x*t[0]+this._y*t[1]+this._z*t[2]}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.dotProduct() requires three integer values";a=this._x*t.x+this._y*t.y+this._z*t.z}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.dotProduct() requires three integer values";a=this._x*t+this._y*e+this._z*r}return a},SimpleVector3.prototype.equals=function(t,e,r){if(void 0===t)throw console.trace(),"GraphNode.equals() requires at least a parameter object";let a=!1;if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.dotProduct() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.dotProduct() requires three integer values";a=this._x===t[0]&&this._y===t[1]&&this._z===t[2]}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.dotProduct() requires three integer values";a=this._x===t.x&&this._y===t.y&&this._z===t.z}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.dotProduct() requires three integer values";a=this._x===t&&this._y===e&&this._z===r}return a},SimpleVector3.prototype.set=function(t,e,r){if(void 0===t)throw console.trace(),"SimpleVector3.set() requires at least one parameter object";if(isNaN(parseFloat(t)))if(Array.isArray(t)){if(3!==t.length)throw console.trace(t),"SimpleVector3.set() was supplied an array that did not have three values";if(isNaN(parseFloat(t[0]))||isNaN(parseFloat(t[1]))||isNaN(parseFloat(t[2])))throw console.trace(t,e,r),"SimpleVector3.set() requires three integer values";this._x=t[0],this._y=e[1],this._z=r[2]}else{if(!t.hasOwnProperty("x")||isNaN(parseFloat(t.x))||!t.hasOwnProperty("y")||isNaN(parseFloat(t.y))||!t.hasOwnProperty("z")||isNaN(parseFloat(t.z)))throw console.trace(t),"SimpleVector3.set() requires three integer values";this._x=t.x,this._y=t.y,this._z=t.z}else{if(isNaN(parseFloat(e))||isNaN(parseFloat(r)))throw console.trace(t,e,r),"SimpleVector3.set() requires three integer values";this._x=t,this._y=e,this._z=r}},SimpleVector3.prototype.toString=function(){return["[x=",this._x,",y=",this._y,",z=",this._z,"]"].join("")},AlignmentGrid.prototype=Object.create(Phaser.GameObjects.Group.prototype),AlignmentGrid.prototype.constructor=Phaser.GameObjects.Group,AlignmentGrid.prototype.placeAt=function(t,e,r){let a=this._cellWidth*t+this._cellWidth/2,i=this._cellHeight*e+this._cellHeight/2;r.x=a,r.y=i},AlignmentGrid.prototype.show=function(){void 0===this.graphics&&(this.graphics=this._parent.add.graphics({lineStyle:{width:4,color:16711680,alpha:1}}));for(let t=0;t<=this._parent.scale.width;t+=this._cellWidth){let e=new Phaser.Geom.Line(t,0,t,this._parent.scale.height);this.graphics.strokeLineShape(e)}for(let t=0;t<=this._parent.scale.height;t+=this._cellHeight){let e=new Phaser.Geom.Line(0,t,this._parent.scale.width,t);this.graphics.strokeLineShape(e)}},CardGame.prototype.drawCard=function(){return this._deck.splice(Dice.getRandomIndex(this._deck),1)[0]},CardGame.prototype.shuffleDeck=function(){for(let t=this._discard.length-1;t>=0;t--)this._deck.push(this._discard.splice(t,1)[0])},UiScene.prototype=Object.create(Phaser.Scene.prototype),UiScene.prototype.constructor=Phaser.Scene,UiScene.prototype.create=function(t){let e=new AlignmentGrid({parent:this._scene,columns:this._grid.columns,rows:this._grid.rows});e.show();let r=Object.keys(this._VIEWS);r.sort();for(let t=r.length-1;t>=0;t--){let a=this._VIEWS[r[t]],i=this._scene.add.group();a.group=i,a.children.sort(function(t,e){let r=0;return"graphics-texture"===t.type&&"graphics-texture"!==e.type?r=-1:"graphics-texture"!==t.type&&"graphics-texture"===e.type&&(r=1),r});for(let t=0,r=a.children.length;t<r;t++){let r=a.children[t];if(r.hasOwnProperty("scale controlled args")){let t=r["scale controlled args"];for(let e=t.length-1;e>=0;e--){let a=t[e];r.args[a.index]*=this._scene.scale[a.dimension]}}switch(r.type){case"graphics-texture":let t=this._scene.make.graphics(),e=r.commands;e.sort(function(t,e){let r=0;return t.order<e.order?r=-1:t.order>e.order&&(r=1),r});for(let r=0,a=e.length;r<a;r++){let a=e[r];if(a.hasOwnProperty("scale controlled args")){let t=a["scale controlled args"];for(let e=t.length-1;e>=0;e--){let r=t[e];a.args[r.index]*=this._scene.scale[r.dimension]}}t[a.command](...a.args)}continue}let s=this._scene.add[r.type](...r.args);switch(r.hasOwnProperty("origin")?s.setOrigin(...r.origin):s.setOrigin(.5),r.type){case"bitmapText":if(r.hasOwnProperty("scale")&&s.setScale(r.scale),r.hasOwnProperty("tint")&&s.setTint(r.tint),r.hasOwnProperty("alpha")&&s.setAlpha(r.alpha),r.hasOwnProperty("dropShadow")&&s.setDropShadow(...r.dropShadow),r.hasOwnProperty("maxWidth"))if(Array.isArray())r.maxWidth[0]<1&&(r.maxWidth[0]*=this._scene.scale.width),s.setMaxWidth(...r.maxWidth);else{if(isNaN(parseFloat(r.maxWidth)))throw["Invalid setting for maxWidth",r];r.maxWidth<1?s.setMaxWidth(r.maxWidth*this._scene.scale.width):s.setMaxWidth(r.maxWidth)}}if(r.hasOwnProperty("listeners")){let t=Object.keys(r.listeners);for(let e=t.length-1;e>=0;e--)switch(r.type){case"dom":s.addListener(t[e]),s.on(t[e],new Function(r.listeners[t[e]].args,r.listeners[t[e]].body));break;default:r.listeners[t[e]].hasOwnProperty("context")?s.addListener(t[e],new Function(r.listeners[t[e]].args,r.listeners[t[e]].body),r.listeners[t[e]].context):s.addListener(t[e],new Function(r.listeners[t[e]].args,r.listeners[t[e]].body))}}r.hasOwnProperty("interactive")&&s.setInteractive(...r.interactive),r.hasOwnProperty("dynamicField")&&this._dynamicFields.put(r.dynamicField,s),i.add(s,!0),e.placeAt(r.position[0],r.position[1],s)}i.setVisible(!1)}},UiScene.prototype.update=function(t,e){if(!this._stateChangeResolved){let t=Object.keys(this._VIEWS);for(let e=t.length-1;e>=0;e--)this._VIEWS[t[e]].group.setVisible(!1);this._VIEWS[this._state].group.setVisible(!0),this._stateChangeResolved=!0}};var Dice={ONE_D2:new Die(1,2),TWO_D2:new Die(2,2),ONE_D3:new Die(1,3),TWO_D3:new Die(2,3),ONE_D4:new Die(1,4),TWO_D4:new Die(2,4),ONE_D6:new Die(1,6),TWO_D6:new Die(2,6),THREE_D6:new Die(3,6),FOUR_D6:new Die(4,6),ONE_D8:new Die(1,8),ONE_D10:new Die(1,10),TWO_D10:new Die(2,10),FIVE_D10:new Die(5,10),ONE_D11:new Die(1,11),ONE_D12:new Die(1,12),ONE_D20:new Die(1,20),ONE_D100:new Die(1,100),getRandomIndex:function(t){if(void 0===t)throw console.trace(t),"Dice.getRandomIndex requires an Object or Array";if(null===t)throw console.trace(t),"Dice.getRandomIndex requires an Object or Array";var e;if(Array.isArray(t)){if(0===t.length)throw console.trace(t),"Dice.getRandomIndex cannot get a random index from an empty Array";e=Math.floor(Math.random()*Math.floor(t.length))}else{if("object"!=typeof t)throw console.trace(t),"Dice.getRandomIndex requires an Object or Array";var r=Object.keys(t);if(0===r.length)throw console.trace(t),"Dice.getRandomIndex cannot get a random index from an empty Object";e=r[Math.floor(Math.random()*Math.floor(r.length))]}return e},getRandomMember:function(t){if(void 0===t)throw console.trace(t),"Dice.getRandomMember requires an Object or Array";if(null===t)throw console.trace(t),"Dice.getRandomMember requires an Object or Array";var e;if(Array.isArray(t)){if(0===t.length)throw console.trace(t),"Dice.getRandomMember cannot get a random index from an empty Array";e=t[Math.floor(Math.random()*Math.floor(t.length))]}else{if("object"!=typeof t)throw console.trace(t),"Dice.getRandomMember requires an Object or Array";var r=Object.keys(t);if(0===r.length)throw console.trace(t),"Dice.getRandomMember cannot get a random index from an empty Object";e=t[r[Math.floor(Math.random()*Math.floor(r.length))]]}return e},rollDie:function(t){return Math.floor(Math.random()*Math.floor(t))+1},rollD66:function(){var t=[this.rollDie(6),this.rollDie(6)];return t.sort(),10*t[0]+t[1]}};function Die(t,e){this._rolls=t,this._faces=e,this.roll=function(){for(var t=0,e=this._rolls;e>0;e--)t+=Math.floor(Math.random()*Math.floor(this._faces))+1;return t}}Object.defineProperty(Die.prototype,"faces",{get(){return this._faces}}),Object.defineProperty(Die.prototype,"rolls",{get(){return this._rolls}}),Object.freeze(Die),Object.freeze(Dice);const Interactive=function(){var t=[],e=0;return{get lastId(){return e},addIo:function(e){if(null==e||!(e instanceof this.IoClass))throw"Interactive.addIo() requires an instance of InteractiveObject";for(var r=-1,a=t.length-1;a>=0;a--){if(null==(e=t[a])){r=a;break}}r>=0?t[r]=e:t.push(e)},addItem:function(){throw"Interactive.addItem() - Do not call this from base instance, extend this. check ../tests/samples/sample_interactive.js for an example"},addNpc:function(){throw"Interactive.addNpc() - Do not call this from base instance, extend this. check ../tests/samples/sample_interactive.js for an example"},addPc:function(){throw"Interactive.addPc() - Do not call this from base instance, extend this. check ../tests/samples/sample_interactive.js for an example"},createFreeIo:function(){for(var r=0,a=t.length;r<a;r++){if(null==(i=t[r]))break}var i=new this.IoClass(e++);return r===t.length?t.push(i):t[r]=i,i},resetAllNpcBehaviours:function(){for(var e=t.length-1;e>=0;e--){var r=t[e];null!=r&&r.ioFlags.has(this.BaseConstants.IO_NPC)&&r.data.resetBehaviour()}},removeFromAllInventories:function(e){if(!this.isValidIo(e))throw"Interactive.removeFromAllInventories() needs an IO to remove";for(var r=t.length-1;r>=0;r--)if(this.isValidIo(t[r])){var a=t[r].inventory;null!=a&&a.removeFromInventory(e)}},replaceInAllInventories:function(e,r){if(!this.isValidIo(e))throw"Interactive.replaceInAllInventories() needs an IO to replace";if(!this.isValidIo(r))throw"Interactive.replaceInAllInventories() needs an IO to replace with";for(var a=t.length-1;a>=0;a--){var i=t[a].inventory;null!=i&&i.replaceInInventory(e,r)}},getIo:function(e){if(isNaN(parseInt(e)))throw"Interactive.getIo() needs a valid reference id";for(var r,a=t.length-1;a>=0;a--)if(this.isValidIo(t[a])&&t[a].refId===e){r=t[a];break}return r},getInteractiveRefId:function(e){if(null==e||!(e instanceof this.IoClass))throw"Interactive.getInteractiveRefId() needs a valid IO";for(var r=-1,a=t.length-1;a>=0;a--)if(e.equals(t[a])){r=t[a].refId;break}return r},isSameObject:function(t,e){if(null==t||!(t instanceof this.IoClass))throw"Interactive.isSameObject() needs a valid IO to compare";if(null==e||!(e instanceof this.IoClass))throw"Interactive.isSameObject() needs a valid IO to compare with";var r=!1;return t.ioFlags.has(this.BaseConstants.IO_UNIQUE)||e.ioFlags.has(this.BaseConstants.IO_UNIQUE)||t.ioFlags.has(this.BaseConstants.IO_ITEM)&&e.ioFlags.has(this.BaseConstants.IO_ITEM)&&!t.hasOverscript()&&!e.hasOverscript()&&t.localizedName.toLowerCase()===e.localizedName.toLowerCase()&&(r=!0),r},isValidIo:function(t){return null!=t&&this.getInteractiveRefId(t)>=0},validIONum:function(e){if(isNaN(parseInt(e)))throw"Interactive.validIONum() requires an integer";for(var r=!1,a=t.length-1;a>=0;a--)if(this.isValidIo(t[a])&&t[a].refId===e){r=!0;break}return r},destroyDynamicInfo:function(e){if(!this.isValidIo(e))throw"Interactive.destroyDynamicInfo() needs an IO to release";if(e.ioFlags.has(this.BaseConstants.IO_ITEM))for(var r=t.length-1;r>=0;r--){var a=t[r];null!=a&&this.isValidIo(a)&&a.ioFlags.has(this.BaseConstants.IO_PC)&&a.data.hasEquipped(e)&&a.data.unequip(e)}this.ScriptInstance.eventStackClearForIo(e),this.isValidIo(e)},releaseIo:function(e){if(!this.isValidIo(e))throw"Interactive.releaseIo() needs an IO to release";this.destroyDynamicInfo(e),this.ScriptInstance.timerClearForIO(e),e.removeAllSpellsOn(),this.removeFromAllInventories(e),null!==e.script&&e.script.clearVariables(),null!==e.overscript&&e.overscript.clearVariables(),e.removeFromAllGroups();for(var r=t.length-1;r>=0;r--)if(t[r].equals(e)){t[r]=null;break}e=null}}}(),Script=function(){var t,e,r,a=null,i={},s={1:"INIT",2:"INVENTORY_IN",3:"INVENTORY_OUT",4:"INVENTORY_USE",6:"EQUIP_IN",7:"EQUIP_OUT",8:"MAIN",9:"RESET",10:"CHAT",11:"ACTION",12:"DEAD",16:"HIT",17:"DIE",22:"DETECT_PLAYER",23:"UNDETECT_PLAYER",28:"INVENTORY2_OPEN",29:"INVENTORY2_CLOSE",33:"INIT_END",46:"HEAR",55:"COLLIDE_NPC",57:"AGGRESSION"};return{get eventSender(){return a},set eventSender(t){if(null!==t&&!this.InteractiveInstance.isValidIo(t))throw"Script.eventSender must be either null or a valid IO";a=t},_checkIsEventAllowed:function(t,e){void 0===r&&(r={COLLIDE_NPC:this.BaseConstants.DISABLE_COLLIDE_NPC,CHAT:this.BaseConstants.DISABLE_CHAT,HIT:this.BaseConstants.DISABLE_HIT,INVENTORY2_OPEN:this.BaseConstants.DISABLE_INVENTORY2_OPEN,HEAR:this.BaseConstants.DISABLE_HEAR,UNDETECT_PLAYER:this.BaseConstants.DISABLE_DETECT,DETECT_PLAYER:this.BaseConstants.DISABLE_DETECT,AGGRESSION:this.BaseConstants.DISABLE_AGGRESSION,MAIN:this.BaseConstants.DISABLE_MAIN,CURSORMODE:this.BaseConstants.DISABLE_CURSORMODE,EXPLORATIONMODE:this.BaseConstants.DISABLE_EXPLORATIONMODE});var a=!0;return r.hasOwnProperty(t)&&e.allowedEvents.has(r[t])&&(a=!1),a},clearGlobalVariables:function(){for(var t in i)delete i[t]},getGlobalVariable:function(t){if(!i.hasOwnProperty(t))throw["Script.getGlobalVariable() - Missing variable '",t,"'"].join("");return i[t]},hasGlobalVariable:function(t){return i.hasOwnProperty(t)},setGlobalVariable:function(t,e){if(void 0===t||void 0===e)throw"need key-value pair when setting script variables";if("string"!=typeof t)throw"key must be a string";if(0===t.length)throw"key cannot be an empty string";i[t]=e},sendScriptEvent:function(t){if(void 0===typeof t||null===t)throw"Script.sendScriptEvent()  requires a parameter object";var e;if(!t.hasOwnProperty("io")||!this.InteractiveInstance.isValidIo(t.io))throw"Script.sendScriptEvent() requires a valid IO";var r=t.script;if(void 0===typeof t||!(t.script instanceof this.ScriptClass))throw"Script.sendScriptEvent() requires a valid script";if(void 0===t.eventId&&void 0===t.eventName)throw"Script.sendScriptEvent() requires an event id or name to process";var a=s[t.eventId];if(void 0===a&&(a=t.eventName),void 0===a)throw["Script.sendScriptEvent() cannot process event '",t.eventId,"'"].join("");if(t.io.ioFlags.has(this.BaseConstants.IO_NPC)&&t.io.data.isDead()&&"DEAD"!==a&&"DIE"!==a&&(e=this.BaseConstants.ACCEPT),void 0===e){var i=t.script.master;null==i&&(i=t.script),this._checkIsEventAllowed(a,i)||(e=this.BaseConstants.REFUSE),e!==this.BaseConstants.REFUSE&&(e=r.execute(a,{io:t.io,params:t.params}))}return e},sendInitScriptEvent:function(t){if(!this.InteractiveInstance.isValidIo(t))throw"Script.sendInitScriptEvent() needs an IO to initialize";var e=a;return a=null,null!==t.script&&this.sendScriptEvent({script:t.script,eventId:this.BaseConstants.SM_INIT,io:t}),t.hasOverscript()&&this.sendScriptEvent({script:t.overscript,eventId:this.BaseConstants.SM_INIT,io:t}),null!==t.script&&this.sendScriptEvent({script:t.script,eventId:this.BaseConstants.SM_INITEND,io:t}),t.hasOverscript()&&this.sendScriptEvent({script:t.overscript,eventId:this.BaseConstants.SM_INITEND,io:t}),a=e,this.BaseConstants.ACCEPT},sendIOScriptEvent:function(t){var e=-1;if(!this.InteractiveInstance.isValidIo(t.io))throw"Script.sendIOScriptEvent() needs an IO to send reverse events";var r=t.eventId;if(void 0===r&&(r=t.eventName),void 0===r)throw"Script.sendIOScriptEvent() requires an event id or name to process";var i=a;return"INIT"===r||"INITEND"===r||r===this.BaseConstants.SM_INIT||r===this.BaseConstants.SM_INITEND?(this.sendIOScriptEventReverse(t),a=i):t.io.hasOverscript()?(e=this.sendScriptEvent({script:t.io.overscript,eventId:t.eventId,params:t.params,io:t.io,eventName:t.eventName}),a=i,e!==this.BaseConstants.REFUSE&&this.InteractiveInstance.isValidIo(t.io)&&(e=this.sendScriptEvent({script:t.io.script,eventId:t.eventId,params:t.params,io:t.io,eventName:t.eventName}),a=i)):(e=this.sendScriptEvent({script:t.io.script,eventId:t.eventId,params:t.params,io:t.io,eventName:t.eventName}),a=i),e},sendIOScriptEventReverse:function(t){var e=-1;if(!this.InteractiveInstance.isValidIo(t.io))throw"Script.sendIOScriptEventReverse() needs an IO to send reverse events";return t.io.hasOverscript()?(e=this.sendScriptEvent({script:t.io.script,eventId:t.eventId,params:t.params,io:t.io,eventName:t.eventName}))!==this.BaseConstants.REFUSE&&this.InteractiveInstance.isValidIo(t.io)&&(e=this.sendScriptEvent({script:t.io.overscript,eventId:t.eventId,params:t.params,io:t.io,eventName:t.eventName})):e=this.sendScriptEvent({script:t.io.script,eventId:t.eventId,params:t.params,io:t.io,eventName:t.eventName}),e},sendMsgToAllIO:function(t,e){s.hasOwnProperty(t)&&(t=s[t]);for(var r=this.BaseConstants.ACCEPT,a=this.InteractiveInstance.lastId;a>=0;a--)if(this.InteractiveInstance.validIONum(a)){var i=this.InteractiveInstance.getIo(a),o=this.sendIOScriptEvent({io:i,eventName:t,params:e});o===this.BaseConstants.REFUSE&&(r=o)}return r},reset:function(t,e){if(!this.InteractiveInstance.isValidIo(t))throw"Script.reset() needs an IO to reset";if(void 0===e&&(e=!1),"boolean"!=typeof e)throw"Script.reset() requires a boolean for the initialization flag";t.script.clearVariables(),t.hasOverscript()&&t.overscript.clearVariables(),this.resetObject(t,e)},resetObject:function(t,e){if(!this.InteractiveInstance.isValidIo(t))throw"Script.resetObject() needs an IO to reset";if(void 0===e&&(e=!1),"boolean"!=typeof e)throw"Script.resetObject() requires a boolean for the initialization flag";null!==t.script&&(t.script.allowedEvents.clear(),e&&this.sendScriptEvent({script:t.script,eventId:this.BaseConstants.SM_INIT,io:t}),this.InteractiveInstance.isValidIo(t)&&(t.mainevent="MAIN")),t.hasOverscript()&&(t.overscript.allowedEvents.clear(),e&&this.sendScriptEvent({script:t.overscript,eventId:this.BaseConstants.SM_INIT,io:t})),e&&(null!==t.script&&this.sendScriptEvent({script:t.script,eventId:this.BaseConstants.SM_INITEND,io:t}),t.hasOverscript()&&this.sendScriptEvent({script:t.overscript,eventId:this.BaseConstants.SM_INIT,io:t}))},resetAll:function(t){if(void 0===t&&(t=!1),"boolean"!=typeof t)throw"Script.resetAll() requires a boolean for the initialization flag";for(var e=this.InteractiveInstance.lastid;e>=0;e--)this.InteractiveInstance.validIONum(e)&&this.reset(this.InteractiveInstance.getIo(e),t)},eventStackClear:function(){if(void 0===t){t=[];for(var e=this.BaseConstants.MAX_EVENT_STACK;e>0;e--)t.push(new this.StackedEventClass)}for(e=t.length-1;e>=0;e--)t[e].exists&&t[e].clear()},eventStackInit:function(){void 0===t&&(t=[]),t.length=0;for(var e=this.BaseConstants.MAX_EVENT_STACK;e>0;e--)t.push(new this.StackedEventClass)},eventStackClearForIo:function(e){if(!this.InteractiveInstance.isValidIo(e))throw"Script.eventStackClearForIo() needs an IO to clear the event stack for";if(void 0===t){t=[];for(var r=this.BaseConstants.MAX_EVENT_STACK;r>0;r--)t.push(new this.StackedEventClass)}r=0;for(var a=t.length;r<a;r++)t[r].exists&&t[r].io.equals(e)&&t[r].clear()},eventStackExecute:function(e){if(isNaN(parseInt(e))&&(e=20),void 0===t){t=[];for(var r=this.BaseConstants.MAX_EVENT_STACK;r>0;r--)t.push(new this.StackedEventClass)}for(var i=0,s=(r=0,t.length);r<s&&(t[r].exists&&this.InteractiveInstance.isValidIo(t[r].io)&&(a=null,this.InteractiveInstance.isValidIo(t[r].sender)&&(a=t[r].sender),this.sendIOScriptEvent({io:t[r].io,eventId:t[r].eventId,params:t[r].params,eventName:t[r].eventName})),t[r].clear(),!(++i>=e));r++);},eventStackExecuteAll:function(){this.eventStackExecute(9999999)},stackSendMsgToAllNpcIo:function(t,e){for(var r=this.InteractiveInstance.lastid;r>=0;r--)if(this.InteractiveInstance.validIONum(r)){var a=this.InteractiveInstance.getIo(r);a.ioFlags.has(this.BaseConstants.IO_NPC)&&this.stackSendIOScriptEvent({io:a,eventId:t,params:e})}},stackSendIOScriptEvent:function(e){if(void 0===t){t=[];for(var r=this.BaseConstants.MAX_EVENT_STACK;r>0;r--)t.push(new this.StackedEventClass)}r=0;for(var i=this.BaseConstants.MAX_EVENT_STACK;r<i;r++)if(!t[r].exists){t[r].params=e.params,t[r].eventName=e.eventName,t[r].sender=a,t[r].io=e.io,t[r].eventId=e.eventId,t[r].exists=!0;break}},checkTimerIndex:function(t){if("string"!=typeof t||0===t.length)throw"Script.checkTimerIndex() needs a valid name";if(void 0===e){e=[];for(var r=100;r>0;r--)e.push(new this.ScriptTimerClass)}for(var a=-1,i=(r=0,e.length);r<i;r++)if(e[r].exists&&e[r].name.toLowerCase()===t.toLowerCase()){a=r;break}return a},timerCheck:function(){throw"Script.timerCheck() - Do not call this from base instance, extend this. The code below this message shows a sample of what to do"},timerClearAll:function(){if(void 0===e){e=[];for(var t=100;t>0;t--)e.push(new this.ScriptTimerClass)}for(t=e.length-1;t>=0;t--)this.timerClearByNum(t)},timerClearAllLocalsForIO:function(t){if(!this.InteractiveInstance.isValidIo(t))throw"Script.timerClearByIO() needs an IO to release";if(void 0===e){e=[];for(var r=100;r>0;r--)e.push(new this.ScriptTimerClass)}r=0;for(var a=e.length;r<a;r++)e[r].exists&&t.equals(e[r].io)&&t.hasOverscript()&&e[r].script===t.overscript&&this.timerClearByNum(r)},timerClearByIO:function(t){if(!this.InteractiveInstance.isValidIo(t))throw"Script.timerClearByIO() needs an IO to release";if(void 0===e){e=[];for(var r=100;r>0;r--)e.push(new this.ScriptTimerClass)}r=0;for(var a=e.length;r<a;r++)e[r].exists&&t.equals(e[r].io)&&this.timerClearByNum(r)},timerClearByNameAndIO:function(t,r){if("string"!=typeof t||0===t.length)throw"Script.timerClearByNameAndIO() needs a valid name";if(!this.InteractiveInstance.isValidIo(r))throw"Script.timerClearByNameAndIO() needs an IO to release";if(void 0===e){e=[];for(var a=100;a>0;a--)e.push(new this.ScriptTimerClass)}a=0;for(var i=e.length;a<i;a++)e[a].exists&&r.equals(e[a].io)&&e[a].name.toLowerCase()===t.toLowerCase()&&this.timerClearByNum(a)},timerClearByNum:function(t){if(void 0===e){e=[];for(var r=100;r>0;r--)e.push(new this.ScriptTimerClass)}if(t<0||t>=e.length)throw["Script.timerClearByNum() - invalid index ",t].join("");e[t].exists&&e[t].clear()},timerClearForIO:function(t){if(!this.InteractiveInstance.isValidIo(t))throw"Script.timerClearForIO() needs an IO to release";if(void 0===e){e=[];for(var r=100;r>0;r--)e.push(new this.ScriptTimerClass)}r=0;for(var a=e.length;r<a;r++)e[r].exists&&t.equals(e[r].io)&&this.timerClearByNum(r)},timerFirstInit:function(t){t<100&&(t=100),void 0===e&&(e=[]),e.length=0;for(var r=t;r>0;r--)e.push(new this.ScriptTimerClass)},timerGetDefaultName:function(){for(var t,e=1;t=["TIMER_",e].join(""),e++,-1!==this.checkTimerIndex(t););return t},timerGetFree:function(){if(void 0===e){e=[];for(var t=100;t>0;t--)e.push(new this.ScriptTimerClass)}t=0;for(var r,a=e.length;t<a;t++)if(!e[t].exists){r=e[t];break}return r}}}(),AmigaUiFactoryOld={getSpanElement:function(t){if(null==t)throw"AmigaUiFactory.getSpanElement() requires a parameterObject";var e=$("<span>");if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("callback")&&(e.addClass("amiga-pointer"),e.click(t.callback)),e},getTableElement:function(t){if(null==t)throw"AmigaUiFactory.getTableElement() requires a parameterObject";var e=$("<table>",{class:"amiga-table"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return e},getTextAreaElement:function(t){if(null==t)throw"AmigaUiFactory.getTextAreaElement() requires a parameterObject";var e=$("<textarea>",{class:"amiga-textarea"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("callback")&&(e.addClass("nes-pointer"),e.click(t.callback)),e},getTextElement:function(t){if(null==t)throw"AmigaUiFactory.getTextElement() requires a parameterObject";var e=$("<span>",{class:"amiga-text"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("callback")&&(e.addClass("nes-pointer"),e.click(t.callback)),e},getColumn:function(t){void 0===t&&(t={});var e=$("<div>",{class:"col"});return t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),e},getContainer:function(t){void 0===t&&(t={});var e=$("<div>",{class:"container"});return t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),e},getRow:function(t){void 0===t&&(t={});var e=$("<div>",{class:"row"});return t.hasOwnProperty("classes")&&e.addClass(t.classes),e},getPanel:function(t){if(null==t)throw"AmigaUiFactory.getPanel() requires a parameterObject";var e=$("<section>",{class:"nes-container"});return t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("title")&&(e.addClass("with-title"),e.append($("<h3>",{class:"title"}).html(t.title))),e}};var ContentBuilder=function(){var t;return{set uiFactory(e){t=e},anchor:function(e,r,a){var i=t.getAnchor(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(var s=0,o=e.children.length;s<o;s++)this[e.children[s].type](e.children[s],i,a);r.append(i)},"app-window":function(e,r,a){let i=t.getAppWindow(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(let t=0,r=e.children.length;t<r;t++)this[e.children[t].type](e.children[t],i,a);r.append(i)},button:function(e,r,a){var i=t.getButton(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},container:function(e,r,a){var i=t.getContainerElement(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i);for(var s=0,o=e.children.length;s<o;s++)this[e.children[s].type](e.children[s],i,a);r.append(i)},div:function(e,r,a){let i=t.getDivElement(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(let t=0,r=e.children.length;t<r;t++)this[e.children[t].type](e.children[t],i,a);r.append(i)},"flex-row":function(e,r,a){let i=t.getFlexRow(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(let s=0,o=e.children.length;s<o;s++){e.hasOwnProperty("length")&&s>0&&s%e.length==0&&(r.append(i),i=t.getFlexRow(e));try{this[e.children[s].type](e.children[s],i,a)}catch(t){throw console.trace(e.children[s]),t}}r.append(i)},"flex-col":function(e,r,a){let i=t.getFlexCol(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(let s=0,o=e.children.length;s<o;s++){e.hasOwnProperty("length")&&s>0&&s%e.length==0&&(r.append(i),i=t.getFlexCol(e));try{this[e.children[s].type](e.children[s],i,a)}catch(t){throw console.trace(e.children[s]),t}}r.append(i)},h1:function(e,r,a){var i=t.getH1Element(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},h2:function(e,r,a){let i=t.getH2Element(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},h3:function(e,r,a){let i=t.getH3Element(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},h4:function(e,r,a){let i=t.getH4Element(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},h5:function(e,r,a){let i=t.getH5Element(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},h6:function(e,r,a){let i=t.getH6Element(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},hr:function(e,r,a){let i=t.getHrElement(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},list:function(e,r,a){var i=t.getList(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i);for(var s=0,o=e.children.length;s<o;s++)this[e.children[s].type](e.children[s],i,a);r.append(i)},listItem:function(e,r,a){var i=t.getListItem(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(var s=0,o=e.children.length;s<o;s++)this[e.children[s].type](e.children[s],i,a);r.append(i)},navbar:function(e,r,a){let i=t.getNavbar(e);if(i.addClass("navbar-expand-sm"),e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children")){let t=$("<ul>",{class:"navbar-nav"});i.append($("<div>",{class:"container-fluid"}).append(t));for(let r=0,i=e.children.length;r<i;r++)this[e.children[r].type](e.children[r],t,a)}r.append(i)},navitem:function(e,r,a){let i=t.getNavitem(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),i.addClass("dropdown"),i.children().first().addClass("dropdown-toggle").attr("data-bs-toggle","dropdown"),e.hasOwnProperty("children")){let t=$("<ul>",{class:"dropdown-menu"});i.append(t);for(let r=0,s=e.children.length;r<s;r++){let s=$("<a>",{class:"dropdown-item",href:"#"}).html(e.children[r].content);e.children[r].hasOwnProperty("callback")&&(e.children[r].callback.hasOwnProperty("args")&&e.children[r].callback.hasOwnProperty("body")&&(e.children[r].callback=new Function(e.children[r].callback.args,e.children[r].callback.body)),s.on("click",e.children[r].callback)),e.children[r].hasOwnProperty("isWatched")&&e.children[r].isWatched&&void 0!==a&&a.addWatchElement(e.children[r].watchParameter,i),t.append($("<li>").append(s))}}r.append(i)},radioGroup:function(e,r,a){for(var i=t.getRadioGroup(e),s=0,o=i.length;s<o;s++)e.buttons[s].hasOwnProperty("isWatched")&&e.buttons[s].isWatched&&void 0!==a&&a.addWatchElement(e.buttons[s].watchParameter,i[s]),r.append(i[s])},section:function(e,r,a){let i=t.getSectionElement(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},span:function(e,r,a){var i=t.getSpanElement(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(var s=0,o=e.children.length;s<o;s++)this[e.children[s].type](e.children[s],i,a);r.append(i)},table:function(e,r,a){var i=t.getTableElement(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i);for(var s=null,o=0,n=e.children.length;o<n;o++)if(Array.isArray(e.children[o])){var h=$("<tr>"),l=e.children[o];i.append(h);for(var c=0,p=l.length;c<p;c++){0===c&&null!==s&&"first"===s.alignment&&(h.append(s.element),s=null);var d=$("<td>"),u=l[c];h.append(d),this[u.type](u,d,a),c+1==p&&null!==s&&"last"===s.alignment&&(d.attr("style","border-right: 0;"),h.append(s.element),s=null)}}else{var f=e.children[o];if("col"===f.type){d=$("<td>");f.hasOwnProperty("style")&&d.attr("style",f.style),f.hasOwnProperty("classes")&&d.addClass(f.classes),f.hasOwnProperty("rowspan")&&d.attr("rowspan",f.rowspan);for(c=0,p=f.children.length;c<p;c++)this[f.children[c].type](f.children[c],d,a);s={element:d,alignment:f.alignment}}}r.append(i)},textarea:function(e,r,a){var i=t.getTextAreaElement(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},text:function(e,r,a){var i=t.getTextElement(e);e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),r.append(i)},"top-level-container":function(e,r,a){let i=t.getTopLevelContainer(e);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(let t=0,r=e.children.length;t<r;t++)try{this[e.children[t].type](e.children[t],i,a)}catch(r){throw console.trace(e.children[t]),r}r.append(i)},window:function(e,r,a){let i=t.getWindow(e,a);if(e.hasOwnProperty("isWatched")&&e.isWatched&&void 0!==a&&a.addWatchElement(e.watchParameter,i),e.hasOwnProperty("children"))for(let t=0,r=e.children.length;t<r;t++)try{this[e.children[t].type](e.children[t],i,a)}catch(r){throw console.trace(e.children[t]),r}r.append(i)}}}();const NesUiFactoryOld={getAnchor:function(t){if(null==t)throw"NesUiFactory.getAnchor() requires a parameterObject";var e=$("<a>");if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("content")&&e.html(t.content),e},getButton:function(t){var e=$("<button>",{class:"nes-btn"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("properties"))for(var r in t.properties)e.prop(r,t.properties[r]);if(t.hasOwnProperty("attr"))for(var a in t.attr)e.attr(a,t.attr[a]);if(t.hasOwnProperty("data"))for(var a in t.data)e.attr(["data-",a].join(""),t.data[a]);return e.click(t.callback),e},getCard:function(t){if(null==t)throw"NesUiFactory.getCard() requires a parameterObject";var e=$("<div>",{class:"card"});if(t.hasOwnProperty("cardClasses"))if(Array.isArray(t.cardClasses))for(var r=t.cardClasses.length-1;r>=0;r--)e.addClass(t.cardClasses[r]);else e.addClass(t.cardClasses);if(t.hasOwnProperty("image")){var a=$("<img>",{class:"card-img-top card-svg-img",src:t.image.src});if(Array.isArray(t.image.classes))for(r=t.image.classes.length-1;r>=0;r--)a.addClass(t.image.classes[r]);else a.addClass(t.image.classes);e.append(a)}if(t.hasOwnProperty("text")){var i=$("<div>",{class:"card-body"});if(Array.isArray(t.text.classes))for(r=t.text.classes.length-1;r>=0;r--)i.addClass(t.text.classes[r]);else i.addClass(t.text.classes);i.append($("<p>",{class:"card-text"}).html(t.text.text)),e.append(i)}return e},getContainerElement:function(t){if(null==t)throw"NesUiFactory.getContainerElement() requires a parameterObject";var e=$("<div>",{class:"nes-container"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("title")){var a=$("<h6>",{class:"container-title"}).html(t.title);e.append(a),t.hasOwnProperty("titleId")&&a.attr("id",t.titleId)}if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return e},getFlexCol:function(t){null==t&&(t={});var e=$("<div>",{class:"d-flex flex-column"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return e},getFlexRow:function(t){null==t&&(t={});var e=$("<div>",{class:"d-flex flex-row"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return e},getH3Element:function(t){if(null==t)throw"NesUiFactory.getTextElement() requires a parameterObject";var e=$("<h3>");if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("callback")&&(e.addClass("nes-pointer"),e.click(t.content)),e},getH4Element:function(t){if(null==t)throw"NesUiFactory.getTextElement() requires a parameterObject";var e=$("<h4>");if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("callback")&&(e.addClass("nes-pointer"),e.click(t.content)),e},getH6Element:function(t){if(null==t)throw"NesUiFactory.getTextElement() requires a parameterObject";var e=$("<h6>");if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("callback")&&(e.addClass("nes-pointer"),e.click(t.callback)),e},getList:function(t){if(null==t)throw"NesUiFactory.getList() requires a parameterObject";var e=$("<ul>");if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return e},getListItem:function(t){if(null==t)throw"NesUiFactory.getListItem() requires a parameterObject";var e=$("<li>");if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("content")&&e.html(t.content),e},getRadioGroup:function(t){if(null==t)throw"NesUiFactory.getRadioGroup() requires a parameterObject";if(!t.hasOwnProperty("name"))throw"NesUiFactory.getRadioGroup() requires a name field for the group";if(!t.hasOwnProperty("buttons"))throw"NesUiFactory.getRadioGroup() requires a list of buttons to populate with";for(var e=[],r=0,a=t.buttons.length;r<a;r++){var i=$("<label>"),s=$("<input>",{class:"nes-radio",name:t.name,type:"radio"});if(t.buttons[r].hasOwnProperty("classes")&&s.addClass(t.buttons[r].classes),t.buttons[r].hasOwnProperty("style")&&i.attr("style",t.buttons[r].style),t.buttons[r].hasOwnProperty("callback")&&s.change(t.buttons[r].callback),t.buttons[r].hasOwnProperty("checked")&&s.attr("checked",t.buttons[r].checked),t.buttons[r].hasOwnProperty("attr"))for(var o in t.buttons[r].attr)s.attr(o,t.buttons[r].attr[o]);if(t.buttons[r].hasOwnProperty("data"))for(var o in t.buttons[r].data)i.attr(["data-",o].join(""),t.buttons[r].data[o]);var n=$("<span>").html(t.buttons[r].content);i.append(s),i.append(n),e.push(i)}return e},getTableElement:function(t){if(null==t)throw"NesUiFactory.getTableElement() requires a parameterObject";var e=$("<table>",{class:"nes-table"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return e},getTextAreaElement:function(t){if(null==t)throw"NesUiFactory.getTextAreaElement() requires a parameterObject";var e=$("<textarea>",{class:"nes-textarea"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("callback")&&(e.addClass("nes-pointer"),e.click(t.callback)),e},getTextElement:function(t){if(null==t)throw"NesUiFactory.getTextElement() requires a parameterObject";var e=$("<span>",{class:"nes-text"});if(t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("attr"))for(var r in t.attr)e.attr(r,t.attr[r]);if(t.hasOwnProperty("content")&&e.html(t.content),t.hasOwnProperty("data"))for(var r in t.data)e.attr(["data-",r].join(""),t.data[r]);return t.hasOwnProperty("callback")&&(e.addClass("nes-pointer"),e.click(t.callback)),e},getColumn:function(t){void 0===t&&(t={});var e=$("<div>",{class:"col"});return t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),e},getContainer:function(t){void 0===t&&(t={});var e=$("<div>",{class:"container"});return t.hasOwnProperty("classes")&&e.addClass(t.classes),t.hasOwnProperty("style")&&e.attr("style",t.style),e},getRow:function(t){void 0===t&&(t={});var e=$("<div>",{class:"row"});return t.hasOwnProperty("classes")&&e.addClass(t.classes),e},getPanel:function(t){if(null==t)throw"NesUiFactory.getPanel() requires a parameterObject";var e=$("<section>",{class:"nes-container"});return t.hasOwnProperty("style")&&e.attr("style",t.style),t.hasOwnProperty("title")&&(e.addClass("with-title"),e.append($("<h3>",{class:"title"}).html(t.title))),e}};function UiFactory(){}UiFactory.prototype.processElement=function(t,e){if(e.hasOwnProperty("classes")&&t.addClass(e.classes),e.hasOwnProperty("style")&&t.attr("style",e.style),e.hasOwnProperty("attr"))for(let r in e.attr)t.attr(r,e.attr[r]);if(e.hasOwnProperty("properties"))for(let r in e.properties)t.prop(r,e.properties[r]);if(e.hasOwnProperty("checked")&&t.attr("checked",e.checked),e.hasOwnProperty("data"))for(let r in e.data)t.attr(["data-",r].join(""),e.data[r]);if(e.hasOwnProperty("content")&&t.html(e.content),e.hasOwnProperty("callback"))if(Object.keys(e.callback).length>0)if(e.callback.hasOwnProperty("args")&&e.callback.hasOwnProperty("body"))e.callback=new Function(e.callback.args,e.callback.body),t.on("click",e.callback);else for(let r in e.callback){let a=new Function(e.callback[r].args,e.callback[r].body);t.on(r,a)}else t.on("click",e.callback)},UiFactory.prototype.getAnchor=function(t){if(null==t)throw"UiFactory.getAnchor() requires a parameterObject";let e=$("<a>");return this.processElement(e,t),e},UiFactory.prototype.getAppWindow=function(t){if(null==t)throw"UiFactory.getAppWindow() requires a parameterObject";let e=$("<div>",{class:"app-window"});return this.processElement(e,t),e},UiFactory.prototype.getButton=function(t){if(null==t)throw"UiFactory.getButton() requires a parameterObject";let e=$("<button>");return this.processElement(e,t),e},UiFactory.prototype.getCard=function(t){if(null==t)throw"UiFactory.getCard() requires a parameterObject";let e=$("<div>",{class:"card"});if(t.hasOwnProperty("cardClasses"))if(Array.isArray(t.cardClasses))for(let r=t.cardClasses.length-1;r>=0;r--)e.addClass(t.cardClasses[r]);else e.addClass(t.cardClasses);if(t.hasOwnProperty("image")){let r=$("<img>",{class:"card-img-top card-svg-img",src:t.image.src});if(Array.isArray(t.image.classes))for(let e=t.image.classes.length-1;e>=0;e--)r.addClass(t.image.classes[e]);else r.addClass(t.image.classes);e.append(r)}if(t.hasOwnProperty("text")){let r=$("<div>",{class:"card-body"});if(Array.isArray(t.text.classes))for(let e=t.text.classes.length-1;e>=0;e--)r.addClass(t.text.classes[e]);else r.addClass(t.text.classes);r.append($("<p>",{class:"card-text"}).html(t.text.text)),e.append(r)}return e},UiFactory.prototype.getContainerElement=function(t){if(null==t)throw"UiFactory.getContainerElement() requires a parameterObject";let e=$("<div>");if(t.hasOwnProperty("title")){let r=$("<h6>",{class:"container-title"}).html(t.title);e.append(r),t.hasOwnProperty("titleId")&&r.attr("id",t.titleId)}return e},UiFactory.prototype.getDivElement=function(t){if(null==t)throw"UiFactory.getDivElement() requires a parameterObject";let e=$("<div>");return this.processElement(e,t),e},UiFactory.prototype.getFlexCol=function(t){null==t&&(t={});let e=$("<div>",{class:"d-flex flex-column"});return this.processElement(e,t),e},UiFactory.prototype.getFlexRow=function(t){null==t&&(t={});let e=$("<div>",{class:"d-flex flex-row"});return this.processElement(e,t),e},UiFactory.prototype.getH1Element=function(t){if(null==t)throw"UiFactory.getH1Element() requires a parameterObject";let e=$("<h1>");return this.processElement(e,t),e},UiFactory.prototype.getH2Element=function(t){if(null==t)throw"UiFactory.getH2Element() requires a parameterObject";let e=$("<h2>");return this.processElement(e,t),e},UiFactory.prototype.getH3Element=function(t){if(null==t)throw"UiFactory.getH3Element() requires a parameterObject";let e=$("<h3>");return this.processElement(e,t),e},UiFactory.prototype.getH4Element=function(t){if(null==t)throw"UiFactory.getH4Element() requires a parameterObject";let e=$("<h4>");return this.processElement(e,t),e},UiFactory.prototype.getH5Element=function(t){if(null==t)throw"UiFactory.getH5Element() requires a parameterObject";let e=$("<h5>");return this.processElement(e,t),e},UiFactory.prototype.getH6Element=function(t){if(null==t)throw"UiFactory.getH6Element() requires a parameterObject";let e=$("<h6>");return this.processElement(e,t),e},UiFactory.prototype.getHrElement=function(t){if(null==t)throw"UiFactory.getH6Element() requires a parameterObject";let e=$("<hr>");return this.processElement(e,t),e},UiFactory.prototype.getList=function(t){if(null==t)throw"UiFactory.getList() requires a parameterObject";let e=$("<ul>");return this.processElement(e,t),e},UiFactory.prototype.getListItem=function(t){if(null==t)throw"UiFactory.getListItem() requires a parameterObject";let e=$("<li>");return this.processElement(e,t),e},UiFactory.prototype.getNavbar=function(t){if(null==t)throw"UiFactory.getNavbar() requires a parameterObject";let e=$("<nav>",{class:"navbar"});return this.processElement(e,t),e},UiFactory.prototype.getNavitem=function(t){if(null==t)throw"UiFactory.getNavitem() requires a parameterObject";let e=$("<li>",{class:"nav-item"}),r=$("<a>",{class:"nav-link",href:"#"});return e.append(r),this.processElement(r,t),e},UiFactory.prototype.getRadioGroup=function(t){if(null==t)throw"UiFactory.getRadioGroup() requires a parameterObject";if(!t.hasOwnProperty("name"))throw"UiFactory.getRadioGroup() requires a name field for the group";if(!t.hasOwnProperty("buttons"))throw"UiFactory.getRadioGroup() requires a list of buttons to populate with";let e=[];for(let r=0,a=t.buttons.length;r<a;r++){let a=$("<label>"),i=$("<input>",{class:"nes-radio",name:t.name,type:"radio"});this.processElement(i,t.buttons[r]);let s=$("<span>").html(t.buttons[r].content);a.append(i),a.append(s),e.push(a)}return e},UiFactory.prototype.getSectionElement=function(t){if(null==t)throw"UiFactory.getSectionElement() requires a parameterObject";let e=$("<section>");return this.processElement(e,t),e},UiFactory.prototype.getSpanElement=function(t){if(null==t)throw"UiFactory.getSpanElement() requires a parameterObject";let e=$("<span>");return this.processElement(e,t),e},UiFactory.prototype.getTextElement=function(t){if(null==t)throw"UiFactory.getTextElement() requires a parameterObject";let e=$("<span>");return this.processElement(e,t),e},UiFactory.prototype.getTopLevelContainer=function(t){if(null==t)throw"UiFactory.getTextElement() requires a parameterObject";let e=$("<div>");return this.processElement(e,t),e},UiFactory.prototype.getWindow=function(t,e){if(null==t)throw"UiFactory.getTextElement() requires a parameterObject";let r=$("<div>");return this.processElement(r,t),r};const AmigaUiFactory=function(){function t(){}return t.prototype=new UiFactory,t.prototype.getButton=function(t){let e=UiFactory.prototype.getButton(t);return e.addClass("amiga-btn"),e},t.prototype.getContainerElement=function(t){let e=UiFactory.prototype.getContainerElement(t);return e.addClass("amiga-container"),e},t.prototype.getTextElement=function(t){let e=UiFactory.prototype.getTextElement(t);return e.addClass("amiga-text"),e},t.prototype.getWindow=function(t){let e=UiFactory.prototype.getWindow(t);return e.addClass("window-content"),t.hasOwnProperty("settings")&&t.settings.footer&&e.addClass("window-content-footer"),e},new t}(),C64UiFactory=function(){function t(){}return t.prototype=new UiFactory,t.prototype.getHrElement=function(t){let e=UiFactory.prototype.getHrElement(t);return e.addClass("c64-hr"),e},t.prototype.getWindow=function(t){let e=UiFactory.prototype.getWindow(t);return e.addClass("window-content"),t.hasOwnProperty("settings")&&t.settings.footer&&e.addClass("window-content-footer"),e},t.prototype.processElement=function(t,e){UiFactory.prototype.processElement(t,e),e.hasOwnProperty("callback")&&t.addClass("c64-pointer")},new t}(),HypercardUiFactory=function(){function t(){}return t.prototype=new UiFactory,t.prototype.processElement=function(t,e){UiFactory.prototype.processElement(t,e),e.hasOwnProperty("callback")&&t.addClass("c64-pointer")},t.prototype.getWindow=function(t,e){let r=UiFactory.prototype.getWindow(t);if(r.addClass("hypercard-container"),t.hasOwnProperty("settings")){if(t.settings.hasOwnProperty("borders-rendered")&&t.settings["borders-rendered"]>0){let e=["0px","0px","0px","0px"],a=0;parseInt(t.settings["borders-rendered"]);1==(1&t.settings["borders-rendered"])&&(e[a]="2px"),a++,2==(2&t.settings["borders-rendered"])&&(e[a]="2px"),a++,4==(4&t.settings["borders-rendered"])&&(e[a]="2px"),a++,8==(8&t.settings["borders-rendered"])&&(e[a]="2px"),r.css("border-width",e.join(" ")),t.settings.hasOwnProperty("border-corners")&&"rounded"===t.settings["border-corners"]&&(e=["0px","0px","0px","0px"],a=0,1==(1&t.settings["borders-rendered"])&&8==(8&t.settings["borders-rendered"])&&(e[a]="10px"),a++,1==(1&t.settings["borders-rendered"])&&2==(2&t.settings["borders-rendered"])&&(e[a]="10px"),a++,4==(4&t.settings["borders-rendered"])&&8==(8&t.settings["borders-rendered"])&&(e[a]="10px"),a++,4==(4&t.settings["borders-rendered"])&&2==(2&t.settings["borders-rendered"])&&(e[a]="10px"),r.css("border-radius",e.join(" ")))}else t.settings.hasOwnProperty("border-corners")&&"rounded"===t.settings["border-corners"]&&r.css("border-radius","10px");if(t.settings.hasOwnProperty("title")){r.addClass("with-title");let a=$("<h3>",{class:"title"}).html(t.settings.title);if(t.settings.hasOwnProperty("title-settings")){if(t.settings["title-settings"].hasOwnProperty("centered")&&t.settings["title-settings"].centered&&a.addClass("is-centered"),t.settings["title-settings"].hasOwnProperty("borders-rendered")&&t.settings["title-settings"]["borders-rendered"]>0){let e=["0px","0px","0px","0px"],r=0;parseInt(t.settings["title-settings"]["borders-rendered"]);1==(1&t.settings["title-settings"]["borders-rendered"])&&(e[r]="2px"),r++,2==(2&t.settings["title-settings"]["borders-rendered"])&&(e[r]="2px"),r++,4==(4&t.settings["title-settings"]["borders-rendered"])&&(e[r]="2px"),r++,8==(8&t.settings["title-settings"]["borders-rendered"])&&(e[r]="2px"),a.css("border-width",e.join(" ")),t.settings["title-settings"].hasOwnProperty("border-corners")&&"rounded"===t.settings["title-settings"]["border-corners"]&&(e=["0px","0px","0px","0px"],r=0,1==(1&t.settings["title-settings"]["borders-rendered"])&&8==(8&t.settings["title-settings"]["borders-rendered"])&&(e[r]="10px"),r++,1==(1&t.settings["title-settings"]["borders-rendered"])&&2==(2&t.settings["title-settings"]["borders-rendered"])&&(e[r]="10px"),r++,4==(4&t.settings["title-settings"]["borders-rendered"])&&8==(8&t.settings["title-settings"]["borders-rendered"])&&(e[r]="10px"),r++,4==(4&t.settings["title-settings"]["borders-rendered"])&&2==(2&t.settings["title-settings"]["borders-rendered"])&&(e[r]="10px"),a.css("border-radius",e.join(" ")),a.css("border-style","solid"),a.css("padding","10px"),a.css("margin-top","-2.8rem"))}else t.settings["title-settings"].hasOwnProperty("border-corners")&&"rounded"===t.settings["title-settings"]["border-corners"]&&(a.css("border-radius","10px"),a.css("border-style","solid"),a.css("padding","10px"),a.css("margin-top","-2.8rem"));t.settings["title-settings"].hasOwnProperty("isWatched")&&t.settings["title-settings"].isWatched&&void 0!==e&&e.addWatchElement(t.settings["title-settings"].watchParameter,a)}r.prepend(a)}}return r},new t}(),I386UiFactory=function(){function t(){}return t.prototype=new UiFactory,t.prototype.getSpanElement=function(t){console.log("sub class. call base");let e=UiFactory.prototype.getSpanElement(t);return t.hasOwnProperty("callback"),e},new t}(),NesUiFactory=function(){function t(){}return t.prototype=new UiFactory,t.prototype.processElement=function(t,e){UiFactory.prototype.processElement(t,e),e.hasOwnProperty("callback")&&t.addClass("nes-pointer")},t.prototype.getWindow=function(t){let e=UiFactory.prototype.getWindow(t);if(e.addClass("nes-container"),t.hasOwnProperty("settings")){if(t.settings.hasOwnProperty("borders-rendered")&&t.settings["borders-rendered"]>0){let r=["0px","0px","0px","0px"],a=0;parseInt(t.settings["borders-rendered"]);1==(1&t.settings["borders-rendered"])&&(r[a]="4px"),a++,2==(2&t.settings["borders-rendered"])&&(r[a]="4px"),a++,4==(4&t.settings["borders-rendered"])&&(r[a]="4px"),a++,8==(8&t.settings["borders-rendered"])&&(r[a]="4px"),e.css("border-width",r.join(" ")),t.settings.hasOwnProperty("border-corners")&&"rounded"===t.settings["border-corners"]&&(r=["0px","0px","0px","0px"],a=0,1==(1&t.settings["borders-rendered"])&&8==(8&t.settings["borders-rendered"])&&(r[a]="10px"),a++,1==(1&t.settings["borders-rendered"])&&2==(2&t.settings["borders-rendered"])&&(r[a]="10px"),a++,4==(4&t.settings["borders-rendered"])&&8==(8&t.settings["borders-rendered"])&&(r[a]="10px"),a++,4==(4&t.settings["borders-rendered"])&&2==(2&t.settings["borders-rendered"])&&(r[a]="10px"),e.css("border-radius",r.join(" ")))}else t.settings.hasOwnProperty("border-corners")&&"rounded"===t.settings["border-corners"]&&e.css("border-radius","10px");if(t.settings.hasOwnProperty("title")){e.addClass("with-title");let r=$("<h3>",{class:"title"}).html(t.settings.title);if(t.settings.hasOwnProperty("title-settings"))if(t.settings["title-settings"].hasOwnProperty("centered")&&t.settings["title-settings"].centered&&r.addClass("is-centered"),t.settings["title-settings"].hasOwnProperty("borders-rendered")&&t.settings["title-settings"]["borders-rendered"]>0){let e=["0px","0px","0px","0px"],a=0;parseInt(t.settings["title-settings"]["borders-rendered"]);1==(1&t.settings["title-settings"]["borders-rendered"])&&(e[a]="4px"),a++,2==(2&t.settings["title-settings"]["borders-rendered"])&&(e[a]="4px"),a++,4==(4&t.settings["title-settings"]["borders-rendered"])&&(e[a]="4px"),a++,8==(8&t.settings["title-settings"]["borders-rendered"])&&(e[a]="4px"),r.css("border-width",e.join(" ")),t.settings["title-settings"].hasOwnProperty("border-corners")&&"rounded"===t.settings["title-settings"]["border-corners"]&&(e=["0px","0px","0px","0px"],a=0,1==(1&t.settings["title-settings"]["borders-rendered"])&&8==(8&t.settings["title-settings"]["borders-rendered"])&&(e[a]="10px"),a++,1==(1&t.settings["title-settings"]["borders-rendered"])&&2==(2&t.settings["title-settings"]["borders-rendered"])&&(e[a]="10px"),a++,4==(4&t.settings["title-settings"]["borders-rendered"])&&8==(8&t.settings["title-settings"]["borders-rendered"])&&(e[a]="10px"),a++,4==(4&t.settings["title-settings"]["borders-rendered"])&&2==(2&t.settings["title-settings"]["borders-rendered"])&&(e[a]="10px"),r.css("border-radius",e.join(" ")),r.css("border-style","solid"),r.css("padding","10px"),r.css("margin-top","-2.8rem"))}else t.settings["title-settings"].hasOwnProperty("border-corners")&&"rounded"===t.settings["title-settings"]["border-corners"]&&(r.css("border-radius","10px"),r.css("border-style","solid"),r.css("padding","10px"),r.css("margin-top","-2.8rem"));e.prepend(r)}}return e},new t}(),RpguiUiFactory=function(){function t(){}return t.prototype=new UiFactory,t.prototype.getSpanElement=function(t){console.log("sub class. call base");let e=UiFactory.prototype.getSpanElement(t);return t.hasOwnProperty("callback"),e},t.prototype.getTopLevelContainer=function(t){console.log("sub class. call base");let e=UiFactory.prototype.getTopLevelContainer(t);return e.addClass("rpgui-content rpgui-cursor-default"),e},new t}();"undefined"!=typeof module&&(module.exports={Condition:Condition,Direction:Direction,EquipmentItemModifier:EquipmentItemModifier,FlagSet:FlagSet,InteractiveObject:InteractiveObject,InventoryData:InventoryData,InventorySlot:InventorySlot,IoBehaviourData:IoBehaviourData,IoEquipItem:IoEquipItem,IoItemData:IoItemData,IoNpcData:IoNpcData,IoPcData:IoPcData,IoScript:IoScript,IoSpellData:IoSpellData,Location:Location,AttributeLookupTable:AttributeLookupTable,VariableKeyTableEntry:VariableKeyTableEntry,PlayerAttribute:PlayerAttribute,PlayerAttributeDescriptors:PlayerAttributeDescriptors,ScriptAction:ScriptAction,ScriptTimer:ScriptTimer,StackedEvent:StackedEvent,Watchable:Watchable,Watcher:Watcher,DijkstraUndirectedSearch:DijkstraUndirectedSearch,EdgeWeightedUndirectedGraph:EdgeWeightedUndirectedGraph,GraphEdge:GraphEdge,WeightedGraphEdge:WeightedGraphEdge,GraphNode:GraphNode,SimpleVector3:SimpleVector3,SimpleVector2:SimpleVector2,HexCoordinateSystem:HexCoordinateSystem,CompoundHexagon:CompoundHexagon,Hexagon:Hexagon,IndexMinPQ:IndexMinPQ,SimpleVector2:SimpleVector2,SimpleVector3:SimpleVector3,AlignmentGrid:AlignmentGrid,CardGame:CardGame,UiScene:UiScene,Dice:Dice,Interactive:Interactive,Script:Script,AmigaUiFactoryOld:AmigaUiFactoryOld,ContentBuilder:ContentBuilder,NesUiFactoryOld:NesUiFactoryOld,AmigaUiFactory:AmigaUiFactory,C64UiFactory:C64UiFactory,HypercardUiFactory:HypercardUiFactory,I386UiFactory:I386UiFactory,NesUiFactory:NesUiFactory,RpguiUiFactory:RpguiUiFactory,UiFactory:UiFactory});